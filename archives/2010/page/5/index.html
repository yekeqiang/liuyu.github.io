<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 5 页 | 归档：2010 | Puppet-in-action</title>
  <meta name="author" content="Liu Yu">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Puppet-in-action"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Puppet-in-action" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Puppet-in-action</a></h1>
  <h2><a href="/">Puppet</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title">2010</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T06:05:34.000Z"><a href="/2010/12/18/vsftpd-virtual-user/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/vsftpd-virtual-user/">vsftpd 安装与虚拟用户配置</a></h1>
  

    </header>
    <div class="entry">
      
        <p>vsftpd 安装与虚拟用户配置</p>
<p>测试环境：
centos 5.X 64bit
vsftpd 2.0</p>
<p>安装：yum -y install vsftpd</p>
<p>需求：
虚拟三个用户，使用同一个家目录。权限如下。
ftpadmin 读写删除
ftpuser 读写
ftp 读(下载)
目录为：/data
密码统一为：123456</p>
<p>一、创建虚拟用户数据库：
1、创建文件文件loginuser.txt
格式如下：</p>
<pre><code><figure class="highlight"><pre><span class="title">user_id</span>
<span class="title">password</span>
/home/loginuser.txt
<span class="title">ftpadmin</span>
<span class="number">123456</span>
<span class="title">ftpuser</span>
<span class="number">123456</span>
<span class="title">ftp</span>
<span class="number">123456</span>
`&lt;/pre&gt;
<span class="number">2</span>、生成数据库文件：

<span class="title">yum</span> -y install db4-utils
&lt;pre&gt;`
<span class="title">db_load</span> -<span class="type">T</span> -t hash -f /home/loginuser.txt /etc/vsftpd/vsftpd_login.db
<span class="title">chmod</span> <span class="number">600</span> /etc/vsftpd/vsftpd_login.db
`&lt;/pre&gt;
<span class="number">3</span>、配置pam文件
# vi /etc/pam.d/vsftpd.vu
&lt;pre&gt;`auth required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login
<span class="title">account</span> required /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login
`&lt;/pre&gt;
#<span class="number">32</span>位操作系统
&lt;pre&gt;`auth required /lib/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login
<span class="title">account</span> required /lib/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login
`&lt;/pre&gt;
二、为虚拟用户创建本地系统用户
&lt;pre&gt;`useradd opendoc -d /<span class="typedef"><span class="keyword">data</span> -s /bin/false</span>
<span class="title">chown</span> opendoc.opendoc /<span class="typedef"><span class="keyword">data</span></span>
`&lt;/pre&gt;
三、vsftpd.conf配置
&lt;pre&gt;`anonymous_enable=<span class="type">NO</span>
<span class="title">local_enable</span>=<span class="type">YES</span>
#write_enable=<span class="type">NO</span>
<span class="title">dirmessage_enable</span>=<span class="type">YES</span>
<span class="title">xferlog_enable</span>=<span class="type">YES</span>
<span class="title">xferlog_file</span>=/var/log/vsftpd.log
<span class="title">connect_from_port_20</span>=<span class="type">YES</span>
<span class="title">xferlog_std_format</span>=<span class="type">YES</span>
<span class="title">listen</span>=<span class="type">YES</span>
<span class="title">listen_port</span>=<span class="number">21</span>
<span class="title">userlist_enable</span>=<span class="type">YES</span>
<span class="title">chroot_local_user</span>=<span class="type">YES</span>
<span class="title">tcp_wrappers</span>=<span class="type">YES</span>
<span class="title">guest_enable</span>=<span class="type">YES</span>
<span class="title">guest_username</span>=opendoc
<span class="title">pam_service_name</span>=vsftpd.vu
<span class="title">user_config_dir</span>=/etc/vsftpd/vsftpd_user_conf
<span class="title">virtual_use_local_privs</span>=<span class="type">YES</span>
<span class="title">pasv_min_port</span>=<span class="number">50000</span>
<span class="title">pasv_max_port</span>=<span class="number">60000</span>
<span class="title">pasv_enable</span>=yes
<span class="title">max_clients</span>=<span class="number">200</span>
<span class="title">max_per_ip</span>=<span class="number">4</span>
<span class="title">idle_session_timeout</span>=<span class="number">600</span>
<span class="title">ftpd_banner</span>=<span class="type">Welcome</span> to opendoc <span class="type">FTP</span> service.
<span class="title">mkdir</span> /etc/vsftpd/vsftpd_user_conf
`&lt;/pre&gt;
# vi /etc/vsftpd/vsftpd_user_conf/ftpadmin 所有权限
&lt;pre&gt;`write_enable=<span class="type">YES</span>
<span class="title">anonymous_enable</span>=<span class="type">NO</span>
<span class="title">anon_world_readable_only</span>=<span class="type">NO</span>
<span class="title">anon_upload_enable</span>=<span class="type">YES</span>
<span class="title">anon_mkdir_write_enable</span>=<span class="type">YES</span>
<span class="title">anon_other_write_enable</span>=<span class="type">YES</span>
<span class="title">local_umask</span>=<span class="number">022</span>
<span class="title">download_enable</span>=<span class="type">Yes</span>
<span class="title">local_root</span>=/<span class="typedef"><span class="keyword">data</span></span>
`&lt;/pre&gt;
# vi /etc/vsftpd/vsftpd_user_conf/ftpuser 上传权限
&lt;pre&gt;`write_enable=<span class="type">YES</span>
<span class="title">anon_world_readable_only</span>=<span class="type">NO</span>
<span class="title">anon_upload_enable</span>=<span class="type">YES</span>
<span class="title">anon_mkdir_write_enable</span>=<span class="type">YES</span>
<span class="title">anon_other_write_enable</span>=<span class="type">YES</span>
<span class="title">local_umask</span>=<span class="number">022</span>
<span class="title">download_enable</span>=<span class="type">NO</span>
<span class="title">local_root</span>=/<span class="typedef"><span class="keyword">data</span></span>
`&lt;/pre&gt;
# vi /etc/vsftpd/vsftpd_user_conf/ftp 只能下载
&lt;pre&gt;`write_enable=<span class="type">NO</span>
<span class="title">anon_world_readable_only</span>=<span class="type">NO</span>
<span class="title">anon_upload_enable</span>=<span class="type">NO</span>
<span class="title">anon_mkdir_write_enable</span>=<span class="type">NO</span>
<span class="title">anon_other_write_enable</span>=<span class="type">NO</span>
<span class="title">local_umask</span>=<span class="number">022</span>
<span class="title">download_enable</span>=yes
<span class="title">local_root</span>=/<span class="typedef"><span class="keyword">data</span></span>
</pre></figure></code></pre>
<h1>/etc/init.d/vsftpd start</h1>
<p>Starting vsftpd for vsftpd: [ OK ]</p>
<p>测试：</p>
<h1>ftp -n localhost</h1>
<p>Connected to ifidc.
530 Please login with USER and PASS.
530 Please login with USER and PASS.
KERBEROS_V4 rejected as an authentication type
220 Welcome to tfhudong FTP service
ftp&gt; use ftpadmin
331 Please specify the password.
Password:
230 Login successful.
ftp&gt; quit
221 Goodbye.</p>
<h1>ftp -n localhost</h1>
<p>Connected to ifidc.
220 Welcome to tfhudong FTP service
530 Please login with USER and PASS.
530 Please login with USER and PASS.
KERBEROS_V4 rejected as an authentication type
ftp&gt; use ftpuser
331 Please specify the password.
Password:
230 Login successful.
ftp&gt; quit
221 Goodbye.</p>
<h1>ftp -n localhost</h1>
<p>Connected to ifidc.
220 Welcome to tfhudong FTP service
530 Please login with USER and PASS.
530 Please login with USER and PASS.
KERBEROS_V4 rejected as an authentication type
ftp&gt; use ftp
331 Please specify the password.
Password:
230 Login successful.
ftp&gt; quit
221 Goodbye.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T05:59:13.000Z"><a href="/2010/12/18/ubuntu-install-smokeping/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/ubuntu-install-smokeping/">ubuntu install smokeping</a></h1>
  

    </header>
    <div class="entry">
      
        <p>aptitude install rrdtool apache2 fping echoping libapache2-mod-speedycgi libwww-perl libsocket6-perl libnet-telnet-perl libnet-dns-perl libnet-ldap-perl libio-socket-ssl-perl libauthen-radius-perl libcgi-perl librrds-perl librrdp-perl
apt-get install smokeping
<a href="http://［IP］/cgi-bin/smokeping.cgi">http://［IP］/cgi-bin/smokeping.cgi</a></p>
<p>配置smokeping,添加监控主机。/etc/smokeping/config.d/ Targets
ubuntu 的iptables 不同于linux
iptables -F
iptables -X</p>
<p>自动会生效，就关闭了iptables</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T00:06:53.000Z"><a href="/2010/12/18/nginx-perl-fcgi-nagios/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/nginx-perl-fcgi-nagios/">Nginx perl fcgi 配置nagios</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Nginx8 + nagios3.2 +perl fcgi</p>
<p>通常使用：nginx 代理+ apache CGI部分交给apache来处理
本文取消apache 改为nginx自己处理</p>
<p>Nginx nagios 安装略</p>
<p>安装perl cgi模块</p>
<pre><code><figure class="highlight"><pre>wget http://www<span class="preprocessor">.cpan</span><span class="preprocessor">.org</span>/modules/by-module/FCGI/FCGI-<span class="number">0.67</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
tar -zxvf FCGI-<span class="number">0.67</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
cd FCGI-<span class="number">0.67</span>
perl Makefile<span class="preprocessor">.PL</span>
make &amp;amp<span class="comment">;&amp;amp; make install</span>
`&lt;/pre&gt;
&lt;!--more--&gt;

安装FCGI-ProcManager:
&lt;pre&gt;`wget http://search<span class="preprocessor">.cpan</span><span class="preprocessor">.org</span>/CPAN/authors/id/G/GB/GBJK/FCGI-ProcManager-<span class="number">0.18</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
tar -xzxf FCGI-ProcManager-<span class="number">0.18</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
cd FCGI-ProcManager-<span class="number">0.18</span>
perl Makefile<span class="preprocessor">.PL</span>
make      make install
`&lt;/pre&gt;
下载nginx-fcgi脚本
Wget http://www<span class="preprocessor">.nginx</span><span class="preprocessor">.eu</span>/nginx-fcgi/nginx-fcgi<span class="preprocessor">.txt</span>
放置在：/etc/nginx-fcgi
启动方法：
/etc/nginx-fcgi –l /var/log/nginx/nginx-fcgi<span class="preprocessor">.log</span> -pid /var/run/nginx-fcgi<span class="preprocessor">.pid</span> -S /var/run/nginx-fcgi<span class="preprocessor">.sock</span>
注意给 nginx-fcgi<span class="preprocessor">.sock</span> <span class="number">777</span>的权限

**运行前使用cpan 安装 FCGI<span class="comment">;Getopt::Long;IO::All;Socket;**</span>

配置文件参考：/usr/local/nginx/conf/vhosts/nagios<span class="preprocessor">.conf</span>
&lt;pre&gt;`server
{
listen <span class="number">80</span><span class="comment">;</span>
server_name IP<span class="comment">;</span>
root /usr/local/nagios/share<span class="comment">;</span>
index index<span class="preprocessor">.php</span><span class="comment">;</span>
location ~ .*\.(php|php5)?$
{
fastcgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span><span class="comment">;</span>
fastcgi_index index<span class="preprocessor">.php</span><span class="comment">;</span>
include enable_php5<span class="preprocessor">.conf</span><span class="comment">;</span>
auth_basic <span class="string">"Nagios Login pain"</span><span class="comment">;</span>
auth_basic_user_file /usr/local/nagios/etc/htpasswd<span class="comment">;</span>
}
location ~ .*\<span class="preprocessor">.cgi</span>$ {
root /usr/local/nagios/sbin<span class="comment">;</span>
rewrite ^/nagios/cgi-bin/(.*)\<span class="preprocessor">.cgi</span> /$<span class="number">1.</span>cgi <span class="keyword">break</span><span class="comment">;</span>
fastcgi_pass unix:/var/run/ng-fcgi<span class="preprocessor">.sock</span><span class="comment">;</span>
fastcgi_index index<span class="preprocessor">.cgi</span><span class="comment">;</span>
fastcgi_param SCRIPT_FILENAME /usr/local/nagios/sbin/$fastcgi_script_name<span class="comment">;</span>
fastcgi_param HTTP_ACCEPT_LANGUAGE <span class="built_in">zh</span>-cn<span class="comment">;</span>
include enable_php5<span class="preprocessor">.conf</span><span class="comment">;</span>
auth_basic <span class="string">"Nagios Login pain"</span><span class="comment">;</span>
auth_basic_user_file /usr/local/nagios/etc/htpasswd<span class="comment">;</span>
}
location /nagios/ {
alias /usr/local/nagios/share/<span class="comment">;</span>
}
`&lt;/pre&gt;
enable_php5<span class="preprocessor">.conf</span> 参考：
&lt;pre&gt;`fastcgi_param GATEWAY_INTERFACE CGI/<span class="number">1.1</span><span class="comment">;</span>
fastcgi_param SERVER_SOFTWARE nginx<span class="comment">;</span>
fastcgi_param QUERY_STRING $query_string<span class="comment">;</span>
fastcgi_param REQUEST_METHOD $request_method<span class="comment">;</span>
fastcgi_param CONTENT_TYPE $content_type<span class="comment">;</span>
fastcgi_param CONTENT_LENGTH $content_length<span class="comment">;</span>
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name<span class="comment">;</span>
fastcgi_param SCRIPT_NAME $fastcgi_script_name<span class="comment">;</span>
fastcgi_param REQUEST_URI $request_uri<span class="comment">;</span>
fastcgi_param DOCUMENT_URI $document_uri<span class="comment">;</span>
fastcgi_param DOCUMENT_ROOT $document_root<span class="comment">;</span>
fastcgi_param SERVER_PROTOCOL $server_protocol<span class="comment">;</span>
fastcgi_param REMOTE_ADDR $remote_addr<span class="comment">;</span>
fastcgi_param REMOTE_PORT $remote_port<span class="comment">;</span>
fastcgi_param SERVER_ADDR $server_addr<span class="comment">;</span>
fastcgi_param SERVER_PORT $server_port<span class="comment">;</span>
fastcgi_param SERVER_NAME $server_name<span class="comment">;</span>
fastcgi_param HTTP_ACCEPT_ENCODING gzip,deflate<span class="comment">;</span>
</pre></figure></code></pre>
<p>参考：<a href="http://bbs.linuxtone.org/thread-4441-1-1.html">http://bbs.linuxtone.org/thread-4441-1-1.html</a>
<a href="http://www.nginx.eu/nginx-fcgi.html">http://www.nginx.eu/nginx-fcgi.html</a>
<a href="http://wiki.nginx.org/NginxSimpleCGI">http://wiki.nginx.org/NginxSimpleCGI</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T00:04:36.000Z"><a href="/2010/12/18/nginx-upgrad/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/nginx-upgrad/">Nginx 无缝升级 </a></h1>
  

    </header>
    <div class="entry">
      
        <h1>/usr/local/nginx/sbin/nginx -v</h1>
<p>nginx version: nginx/0.7.61</p>
<h1>/usr/local/nginx/sbin/nginx -V</h1>
<p>nginx version: nginx/0.7.61
built by gcc 4.1.2 20080704 (Red Hat 4.1.2-44)
configure arguments: --user=www --group=www --prefix=/usr/local/nginx/ --with-http_stub_status_module --with-http_ssl_module --with-md5=/usr/lib --with-sha1=/usr/lib</p>
<p>[root@nagios nginx-0.8.29]# ./configure --user=www --group=www --prefix=/usr/local/nginx/ --with-http_stub_status_module --with-http_ssl_module --with-md5=/usr/lib --with-sha1=/usr/lib
[root@nagios nginx-0.8.29]# make
[root@nagios nginx-0.8.29]# mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.0.7
[root@nagios nginx-0.8.29]# cp objs/nginx /usr/local/nginx/sbin/
[root@nagios nginx-0.8.29]# /usr/local/nginx/sbin/nginx -t
the configuration file /usr/local/nginx//conf/nginx.conf syntax is ok
configuration file /usr/local/nginx//conf/nginx.conf test is successful</p>
<p>[root@nagios nginx-0.8.29]# kill -USR2 <code>cat /usr/local/nginx/nginx.pid</code>
nginx.pid nginx.pid.oldbin</p>
<p>[root@nagios nginx-0.8.29]# kill -QUIT <code>cat /usr/local/nginx/nginx.pid.oldbin</code>
[root@nagios nginx-0.8.29]# /usr/local/nginx/sbin/nginx -v</p>
<p>nginx version: nginx/0.8.29</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-17T23:56:54.000Z"><a href="/2010/12/18/apache-tomcat-cluster-bacst/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/apache-tomcat-cluster-bacst/">Apache Tomcat Cluster-bacst 配置</a></h1>
  

    </header>
    <div class="entry">
      
        <p>关于Apache+Tomcat的Cluster的郁闷问题，终于得到解决</p>
<p>此类话题已经很多，可以参考的文档也不少，我是参考这个blog的文档做的：</p>
<p><a href="http://blogger.org.cn/blog/blog.asp?name=lhwork">http://blogger.org.cn/blog/blog.asp?name=lhwork</a></p>
<p>1）环境和版本：</p>
<p>Apache2.0.59+Tomcat5.5.15（两个），一开始用的是Tomcat5.0.28，一直有问题（在后面总结），就升级到5.5去做试验了，冤枉5.0.28兄弟了:)</p>
<p>步骤小结为：</p>
<p>1、安装（忽略）；</p>
<p>2、配置Tomcat：</p>
<p>1）第一个Tomcat：</p>
<p>A.启用jvmRoute</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;!-- You should set jvmRoute to support load-balancing via AJP ie :--&gt;</p>
<p>&lt;Engine name=&quot;Standalone&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;tomcat1&quot;&gt;</p>
<p>&lt;!-- Define the top level container in our container hierarchy</p>
<p>&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;--&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>B.启用原来禁用的Cluster设置</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Cluster className=&quot;org.apache.catalina.cluster.tcp.SimpleTcpCluster&quot;</p>
<p>managerClassName=&quot;org.apache.catalina.cluster.session.DeltaManager&quot;</p>
<p>expireSessionsOnShutdown=&quot;false&quot;</p>
<p>useDirtyFlag=&quot;true&quot;</p>
<p>notifyListenersOnReplication=&quot;true&quot;&gt;</p>
<p>&lt;Membership</p>
<p>className=&quot;org.apache.catalina.cluster.mcast.McastService&quot;</p>
<p>mcastBindAddress=&quot;127.0.0.1&quot;</p>
<p>mcastAddr=&quot;224.1.2.3&quot;</p>
<p>mcastPort=&quot;2525&quot;</p>
<p>mcastFrequency=&quot;500&quot;</p>
<p>mcastDropTime=&quot;3000&quot;/&gt;</p>
<p>&lt;Receiver</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationListener&quot;</p>
<p>tcpListenAddress=&quot;auto&quot;</p>
<p>tcpListenPort=&quot;4001&quot;</p>
<p>tcpSelectorTimeout=&quot;100&quot;</p>
<p>tcpThreadCount=&quot;6&quot;/&gt;</p>
<p>&lt;Sender</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationTransmitter&quot;</p>
<p>replicationMode=&quot;pooled&quot;</p>
<p>ackTimeout=&quot;15000&quot;/&gt;</p>
<p>&lt;Valve className=&quot;org.apache.catalina.cluster.tcp.ReplicationValve&quot;</p>
<p>filter=&quot;.<em>.gif;.</em>.js;.<em>.jpg;.</em>.png;.<em>.htm;.</em>.html;.<em>.css;.</em>.txt;&quot;/&gt;</p>
<p>&lt;Deployer className=&quot;org.apache.catalina.cluster.deploy.FarmWarDeployer&quot;</p>
<p>tempDir=&quot;/tmp/war-temp/&quot;</p>
<p>deployDir=&quot;/tmp/war-deploy/&quot;</p>
<p>watchDir=&quot;/tmp/war-listen/&quot;</p>
<p>watchEnabled=&quot;false&quot;/&gt;</p>
<p>&lt;ClusterListener className=&quot;org.apache.catalina.cluster.session.ClusterSessionListener&quot;/&gt;</p>
<p>&lt;/Cluster&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>C.搞定</p>
<p>2）配置第二个Tomcat（要注意端口冲突了）：</p>
<p>A.变更端口</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</p>
<p>＝》</p>
<p>&lt;Server port=&quot;8004&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</p>
<p>B.变更端口</p>
<p>&lt;Connector port=&quot;8009&quot;</p>
<p>enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; protocol=&quot;AJP/1.3&quot; /&gt;</p>
<p>＝》</p>
<p>&lt;Connector port=&quot;9009&quot;</p>
<p>enableLookups=&quot;false&quot; redirectPort=&quot;8443&quot; protocol=&quot;AJP/1.3&quot; /&gt;</p>
<p>C.启用jvmRoute</p>
<p>&lt;!-- You should set jvmRoute to support load-balancing via AJP ie :--&gt;</p>
<p>&lt;Engine name=&quot;Standalone&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;tomcat2&quot;&gt;</p>
<p>&lt;!-- Define the top level container in our container hierarchy</p>
<p>&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;--&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>D.启用原来禁用的Cluster设置</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Cluster className=&quot;org.apache.catalina.cluster.tcp.SimpleTcpCluster&quot;</p>
<p>managerClassName=&quot;org.apache.catalina.cluster.session.DeltaManager&quot;</p>
<p>expireSessionsOnShutdown=&quot;false&quot;</p>
<p>useDirtyFlag=&quot;true&quot;</p>
<p>notifyListenersOnReplication=&quot;true&quot;&gt;</p>
<p>&lt;Membership</p>
<p>className=&quot;org.apache.catalina.cluster.mcast.McastService&quot;</p>
<p>mcastBindAddress=&quot;127.0.0.1&quot;</p>
<p>mcastAddr=&quot;224.1.2.3&quot;</p>
<p>mcastPort=&quot;2525&quot;</p>
<p>mcastFrequency=&quot;500&quot;</p>
<p>mcastDropTime=&quot;3000&quot;/&gt;</p>
<p>&lt;Receiver</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationListener&quot;</p>
<p>tcpListenAddress=&quot;auto&quot;</p>
<p>tcpListenPort=&quot;4002&quot;</p>
<p>tcpSelectorTimeout=&quot;100&quot;</p>
<p>tcpThreadCount=&quot;6&quot;/&gt;</p>
<p>&lt;Sender</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationTransmitter&quot;</p>
<p>replicationMode=&quot;pooled&quot;</p>
<p>ackTimeout=&quot;15000&quot;/&gt;</p>
<p>&lt;Valve className=&quot;org.apache.catalina.cluster.tcp.ReplicationValve&quot;</p>
<p>filter=&quot;.<em>.gif;.</em>.js;.<em>.jpg;.</em>.png;.<em>.htm;.</em>.html;.<em>.css;.</em>.txt;&quot;/&gt;</p>
<p>&lt;Deployer className=&quot;org.apache.catalina.cluster.deploy.FarmWarDeployer&quot;</p>
<p>tempDir=&quot;/tmp/war-temp/&quot;</p>
<p>deployDir=&quot;/tmp/war-deploy/&quot;</p>
<p>watchDir=&quot;/tmp/war-listen/&quot;</p>
<p>watchEnabled=&quot;false&quot;/&gt;</p>
<p>&lt;ClusterListener className=&quot;org.apache.catalina.cluster.session.ClusterSessionListener&quot;/&gt;</p>
<p>&lt;/Cluster&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>E.搞定</p>
<p>3、配置apache：</p>
<p>1）修订conf/httpd.conf</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<h1>add by zhengxq</h1>
<p>LoadModule jk2_module modules/mod_jk2.so</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>2）新增worders2.properties并放到conf下</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>[shm]</p>
<p>info=Scoreboard. Requried for reconfiguration and status with multiprocess servers.</p>
<p>file=anon</p>
<h1>Defines a load balancer named lb. Use even if you only have one machine.</h1>
<p>[lb:lb]</p>
<p>worker=ajp13:tomcat1</p>
<p>worker=ajp13:tomcat2</p>
<h1>Example socket channel, override port and host.</h1>
<p>[channel.socket:localhost:9009]</p>
<p>port=9009</p>
<p>host=127.0.0.1</p>
<h1>define the worker</h1>
<p>[ajp13:localhost:9009]</p>
<p>channel=channel.socket:localhost:9009</p>
<p>group=lb</p>
<h1>Example socket channel, override port and host.</h1>
<p>[channel.socket:localhost:8009]</p>
<p>port=8009</p>
<p>host=127.0.0.1</p>
<h1>define the worker</h1>
<p>[ajp13:localhost:8009]</p>
<p>channel=channel.socket:localhost:8009</p>
<p>group=lb</p>
<h1>Map the Tomcat examples webapp to the Web server uri space</h1>
<p>[uri:/clusterapp/*]</p>
<p>group=lb</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>3）搞定</p>
<p>3.测试程序，请参考上述参考文档，如下：</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;%@ page contentType=&quot;text/html; charset=GBK&quot; import=&quot;java.util.*&quot;%&gt;</p>
<p>&lt;html&gt;&lt;head&gt;&lt;title&gt;Cluster App Test&lt;/title&gt;&lt;/head&gt;</p>
<p>&lt;body&gt;</p>
<p>Server Info: &lt;%out.print(request.getLocalAddr() + &quot; : &quot; + request.getLocalPort());%&gt;</p>
<p>&lt;%</p>
<p>out.println(&quot;&lt;br&gt; ID &quot; + session.getId());</p>
<p>// 如果有新的 Session 属性设置</p>
<p>String dataName = request.getParameter(&quot;dataName&quot;);</p>
<p>if (dataName != null &amp;&amp; dataName.length() &gt; 0) {</p>
<p>String dataValue = request.getParameter(&quot;dataValue&quot;);</p>
<p>session.setAttribute(dataName, dataValue);</p>
<p>}</p>
<p>out.print(&quot;&lt;b&gt;Session 列表&lt;/b&gt;&quot;);</p>
<p>Enumeration e = session.getAttributeNames();</p>
<p>while (e.hasMoreElements()) {</p>
<p>String name = (String)e.nextElement();</p>
<p>String value = session.getAttribute(name).toString();</p>
<p>out.println( name + &quot; = &quot; + value);</p>
<p>}</p>
<p>%&gt;</p>
<p>&lt;form action=&quot;index.jsp&quot; method=&quot;POST&quot;&gt;</p>
<p>名称:&lt;input type=text size=20 name=&quot;dataName&quot;&gt;</p>
<p>&lt;br&gt;</p>
<p>值:&lt;input type=text size=20 name=&quot;dataValue&quot;&gt;</p>
<p>&lt;br&gt;</p>
<p>&lt;input type=submit&gt;</p>
<p>&lt;/form&gt;</p>
<p>&lt;/body&gt;</p>
<p>&lt;/html&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>所需要注意的是：</p>
<p>1、测试应用的web.xml必须加上：</p>
<p>2、我搞了很久，发现三个东西起来后，可以访问，但只能做到负载均衡，不能session复制，这点我重复配置了一次，就是不行，郁闷之下找了tomcat的邮件列表，这样做：</p>
<p>1）测试广播是否正常</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>A. download this jar</p>
<p><a href="http://cvs.apache.org/~fhanik/tomcat-replication.jar">http://cvs.apache.org/~fhanik/tomcat-replication.jar</a></p>
<p>B. Open two terminals</p>
<p>a) Terminal one run</p>
<p>java -cp tomcat-replication.jar MCaster 239.255.10.10 2525 Terminal1</p>
<p>b) Terminal two run</p>
<p>java -cp tomcat-replication.jar MCaster 239.255.10.10 2525 Terminal2</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>发现结果如下：</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>C:\&gt;java -cp tomcat-replication.jar MCaster 224.1.2.3 2525 Terminal1</p>
<p>Usage MCaster [address port message]</p>
<p>BEGIN TO RECEIVE</p>
<p>SENT:Terminal11</p>
<p>SENT:Terminal12</p>
<p>SENT:Terminal13</p>
<p>SENT:Terminal14</p>
<p>SENT:Terminal15</p>
<p>SENT:Terminal16</p>
<p>SENT:Terminal17</p>
<p>SENT:Terminal18</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>表明广播有问题，气死了，难怪Tomcat总是在启动的时候提示：</p>
<p>信息: Manager [/clusterapp]: skipping state transfer. No members active in cluster group.</p>
<p>后来终于发现猫腻，必须注意在server.xml的</p>
<p>为什么呢？很简单，因为我安装了VPN，这家伙会设置一个虚拟网卡，导致绑定失败（没地方责怪了，只好让它垫背）？！这是通过邮件列表里面所描述的多网卡绑定问题举一反三得到的判断。</p>
<p>具体请参考：<a href="http://www.servlets.com/archive/servlet/ReadMsg?msgId=475067&amp;listName=tomcat-user">http://www.servlets.com/archive/servlet/ReadMsg?msgId=475067&amp;listName=tomcat-user</a></p>
<p>三、tomcat集群配置，session 同步配置：</p>
<p>1、tomca1 tomcat 2 在同一台机器</p>
<p>Tomcat 1 （IP: 192.168.19.199）</p>
<p>A、修改Engine节点信息：</p>
<p>B、去掉 &lt;\Cluster&gt; 的注释符</p>
<p>C、修改Cluster 节点信息</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Membership</p>
<p>className=&quot;org.apache.catalina.cluster.mcast.McastService&quot;                mcastBindAddress=&quot;192.168.19.199&quot;</p>
<p>mcastAddr=&quot;224.0.0.1&quot;</p>
<p>mcastPort=&quot;45564&quot;</p>
<p>mcastFrequency=&quot;500&quot;</p>
<p>mcastDropTime=&quot;3000&quot;/&gt;</p>
<p>&lt;Receiver</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationListener&quot;                tcpListenAddress=&quot;192.168.19.199&quot;</p>
<p>tcpListenPort=&quot;4001&quot;</p>
<p>tcpSelectorTimeout=&quot;100&quot;</p>
<p>tcpThreadCount=&quot;6&quot;/&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>Tomcat 2 （IP: 192.168.19.81）</p>
<p>A、修改Engine节点信息：</p>
<p>B、去掉 &lt;\Cluster&gt; 的注释符</p>
<p>C、修改Cluster 节点信息</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Membership</p>
<p>className=&quot;org.apache.catalina.cluster.mcast.McastService&quot;</p>
<p>mcastBindAddress=&quot;192.168.19.199&quot;</p>
<p>mcastAddr=&quot;224.0.0.1&quot;</p>
<p>mcastPort=&quot;45564&quot;</p>
<p>mcastFrequency=&quot;500&quot;</p>
<p>mcastDropTime=&quot;3000&quot;/&gt;</p>
<p>&lt;Receiver</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationListener&quot;</p>
<p>tcpListenAddress=&quot;192.168.19.199&quot;</p>
<p>tcpListenPort=&quot;4002&quot;    一定要改</p>
<p>tcpSelectorTimeout=&quot;100&quot;</p>
<p>tcpThreadCount=&quot;6&quot;/&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>D、将8080 8009 8082三个节点的端口改为</p>
<p>9080 9009 9082 避免 与tomcat1端口冲突</p>
<p>注：这里的IP也可以不改</p>
<p>2、tomca1 tomcat 2 在不同机器上</p>
<p>Tomcat 1 （IP: 192.168.19.199）</p>
<p>A、修改Engine节点信息：</p>
<p>B、去掉 &lt;\Cluster&gt; 的注释符</p>
<p>C、修改Cluster 节点信息</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Membership</p>
<p>className=&quot;org.apache.catalina.cluster.mcast.McastService&quot;</p>
<p>mcastBindAddress=&quot;192.168.19.199&quot;</p>
<p>mcastAddr=&quot;224.0.0.1&quot;</p>
<p>mcastPort=&quot;45564&quot;</p>
<p>mcastFrequency=&quot;500&quot;</p>
<p>mcastDropTime=&quot;3000&quot;/&gt;</p>
<p>&lt;Receiver</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationListener&quot;</p>
<p>tcpListenAddress=&quot;192.168.19.199&quot;</p>
<p>tcpListenPort=&quot;4001&quot;</p>
<p>tcpSelectorTimeout=&quot;100&quot;</p>
<p>tcpThreadCount=&quot;6&quot;/&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>Tomcat 2 （IP: 192.168.19.81）</p>
<p>A、修改Engine节点信息：</p>
<p>B、去掉 &lt;\Cluster&gt; 的注释符</p>
<p>C、修改Cluster 节点信息</p>
<p>&lt;pre&gt;&lt;code&gt;</p>
<p>&lt;Membership</p>
<p>className=&quot;org.apache.catalina.cluster.mcast.McastService&quot;</p>
<p>mcastBindAddress=&quot;192.168.19.81&quot;</p>
<p>mcastAddr=&quot;224.0.0.1&quot;</p>
<p>mcastPort=&quot;45564&quot;     mcastFrequency=&quot;500&quot;</p>
<p>mcastDropTime=&quot;3000&quot;/&gt;</p>
<p>&lt;Receiver</p>
<p>className=&quot;org.apache.catalina.cluster.tcp.ReplicationListener&quot;            tcpListenAddress=&quot;192.168.19.81&quot;</p>
<p>tcpListenPort=&quot;4001&quot;</p>
<p>tcpSelectorTimeout=&quot;100&quot;</p>
<p>tcpThreadCount=&quot;6&quot;/&gt;</p>
<p>&lt;/code&gt;&lt;/pre&gt;</p>
<p>修改web应用里面WEB-INF目录下的web.xml文件，加入标签</p>
<p>直接加在之前就可以了</p>
<p>做tomcat集群必须需要这一步，否则用户的session就无法正常使用。</p>
<p>源文档 &lt;<a href="http://www.opendoc.com.cn/webserver/Apache_Tomcat_Cluster.html&amp;gt">http://www.opendoc.com.cn/webserver/Apache_Tomcat_Cluster.html&amp;gt</a>;</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-17T23:53:12.000Z"><a href="/2010/12/18/tomcat-optimization-sending-end-packet/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/tomcat-optimization-sending-end-packet/">Tomcat 优化sending end packet</a></h1>
  

    </header>
    <div class="entry">
      
        <p>优化sending end packet</p>
<p>性能调整：
<a href="http://vod.sjtu.edu.cn/help/Article_Print.asp?ArticleID=1387">http://vod.sjtu.edu.cn/help/Article_Print.asp?ArticleID=1387</a></p>
<p>症状:
WARNING: Error sending end packet
java.net.SocketException: Broken pipe
资料:
Broken pipe产生的原因通常是当管道读端没有在读，而管道的写端继续有线程在写，就会造成管道中断。（由于管道是单向通信的） SIGSEGV(Segment fault)意味着指针所对应的地址是无效地址，没有物理内存对应该地址。 以下是UNIX的信号解释： 11 / SIGSEGV: Unerlaubter Zugriff auf Hauptspeicher (Adressfehler). 12 / SIGUSER2: User-defined Signal 2 (POSIX). 把_JAVA_SR_SIGNUM改成12只是将信号至成user-defined，让它不报出来而已，不能解决问题。 </p>
<p>建议采取的方式：
1． 资源没有完全释放，用完后要至NULL 值（JAVA的GC没那么完善）
2． 数据库连接顺序关闭！（RS，PS，CONN）
3． 优化JAVA虚拟机 加入相应的内存参数！
4． 不要在数据库中获取大段文本（即一个栏位的值不要太大）
5． JAVA 不推荐 用String 获取大量信息。（容易造成内存泄露，建议用StringBuffer）
6． 页面重复提交
7． 尽量将METHOD移到JAVA中，在JSP中所有的方法都看做全局变量，编译执行本身就有很多问题。
8． 尽量用较新较稳定版本的JDK，低版本的JVM本身也有很多BUG，比如1。5的垃圾回收比起1。2，1。3一定是非常明显的进步。
9． LINUX系统本身没有这么稳定，有些问题无法避免的~~：）</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-17T23:51:58.000Z"><a href="/2010/12/18/tomcat-jk-no-connection/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/tomcat-jk-no-connection/">tomcat经常挂 JK无法连接</a></h1>
  

    </header>
    <div class="entry">
      
        <p>解决tomcat死掉JK无法连接故障</p>
<p>近日，发现网站jsp部分无法访问，或者访问速度极其缓慢。经过近二天的时间，问题得到了解决，现在把这解决步骤及思考方法详细的记录下来。其中也走了不少弯路。其结果也是让人无法琢磨！
发现问题时处理思路：</p>
<p>1、检查服务器是否正常连接。掉网、死机啥的。－－－&gt;SSH登录正常
2、检查负载情况，load是否超高,vmstat 检查资源占用率 --－&gt;只有mysql占少量资源，起初以为是mysql导致（检查mysql 状态后发现并没有锁表及DDL语句堆积，执行sql语句速度也很快。因此判断出不是mysql导致）
3、查看tcp连接状态。是不是并发太大被拖死了－－－&gt;其中ESTABLISHED大约有1000左右。TIME_WAIT CLOSE_WAIT 在40左右。看样子tomcat是被拖死了。并发这么大？
4、重启了tomcat 访问正常了。先观察一段时间。
5、查看分析日志，希望能从这里面找出一点蛛丝马迹来。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2010/12/18/tomcat-jk-no-connection/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-17T23:44:30.000Z"><a href="/2010/12/18/php-fpm-explanation/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/php-fpm-explanation/">php-fpm详解</a></h1>
  

    </header>
    <div class="entry">
      
        <p>php-fpm详解
原文链接：<a href="http://php-fpm.anight.org/">http://php-fpm.anight.org/</a>
wiki：<a href="http://www.php-fpm.com/">http://www.php-fpm.com/</a>
翻译：<a href="http://syre.blogbus.com/logs/20092011.html">http://syre.blogbus.com/logs/20092011.html</a></p>
<p>什么是 FastCGI
FastCGI 是一个可伸缩、高速的在web server和脚本语言间通迅的接口。关于FastCGI技术的更多信息可以在官方网 站和Wikipedia看到。
FastCGI 被许多脚本语言所支持，包括 php，如果用 --enable-fastcgi 选项编译的话。
多数流行的web server都支持 FastCGI。包括Apache（mod_fastcgi和mod_fcgid），Zeus，nginx和lighttpd。</p>
<p>FastCGI 的主要优点是把动态语言和 web server 分离开来。这种技术允许 web server 和动态语言运行在不同的主机上。这可以改进可扩展性和安全性而没有大的效率损失。
php-fpm 可以和任何支持外部 FastCGI 技术的 web server 一起使用。</p>
<p>php-fpm是做啥用的
很不幸，官方网站 php.net 上的 php 在将 FastCGI SAPI 用于生产环境方面有许多已知的问题。
下面是关于启用 FastCGI SAPI 时的问题和 php-fpm 是如何解决他们的对比列表。</p>
<p>描述
php自带的
spawn-fcgi + spawn-php.sh + daemontools
php-fpm
php守护进程化： pid file, log file, setsid(), setuid(), setgid(), chroot()
(-)
(+)
(+)
进程管理。可以用 &quot;graceful&quot; 来停止并启动 php worker 进程而不会丢失请求。能够平滑地升级配置和二进制程序而不丢失任何请求。
php4 (-), php5 (只有 graceful)
(-)
(+)
严格限制来源请求的 web server 的 ip 地址
php4 (-) php5 (+) (从 5.2.2 开始)
(-)
(+)
根据负载动态调整进程数
(-)
(-)
Todo
用不同的 uid/gid/chroot/environment 和不同的 php.ini 选项启动 worder 进程。你不需要 safe mode 了！
(-)
(-)
(+)
记录 worker 进程 stdout 和 stderr 日志
(-)
(-)
(+)
如果使用优化器，在共享内存意外破坏的情况下紧急重启所有的进程
(-)
(-)
(+)
如果 set_time_limit() 失败，确保进程会结束
(-)
(-)
(+)</p>
<p>特色功能 Error header、优化的上传支持、fastcgi_finish_request()
特色功能
所有这些特性都是“不打断”的方式实现的。也就是说，如果你不使用它们，它们的存在不会影响php的功能性——他们都是“透明”的。
Error header</p>
<p>范围：php.ini 选项</p>
<p>分类：便利性
默认情况下，如果被访问的php脚本包含语法错误，用户会收到一个空的“200 ok”页。这是不方便的。Error header 这个 php.ini 选项允许在这种情况下产生一个 HTTP 错误码，比如“HTTP/1.0 550 Server Made Big Boo”，从而中断web server请求并显示一个正确的错误页。
如果要实现这样的功能，需要在 php.ini 中添加一条 fastcgi.error_header = &quot;HTTP/1.0 550 Server Made Big Boo&quot;
在 php-5.2.4 中添加了类似，但不相同的功能：如果被访问的php脚本包含语法错误，并且 display_errors = off，会立刻返回“HTTP/1.0 500 Internal Server Error”。
如果你需要设定一个 503 错误，或者想要使这个行为独立于 display_errors 的设置，那么可以使用fastcgi.error_header。如果你在 php-5.2.5 或以上版本上启用 php-fpm，那么 fastcgi.error_header的优先级更高。
优化的上传支持</p>
<p>实质：web server 支持
类型：优化</p>
<p>这个特性正如名字那样，可以加速对大 POST 请求的处理速度，包括文件上传。优化是通过将请求体已写入一个临时文件，然后 fastcgi 协议传递文件名而不是请求体到来实现的。目前就我所知，只有 nginx0.5.9 以上才支持这个功能。显然，这种模式只在 php 和 web server 在一台机器上的时候才能用。
nginx 样例配置：
location ~ .php$ { 
    fastcgi_pass_request_body off; 
    client_body_in_file_only clean; 
    fastcgi_param  REQUEST_BODY_FILE   $request_body_file; 
    ... 
    fastcgi_pass ...; 
} </p>
<p>在php中不需要配置任何东西。如果php收到了参数REQUEST_BODY_FILE，就读取其中的请求体，如果没有，就自行从fastcgi 协议中读取请求体。
结合这个特性，可以考虑对临时文件使用内存文件系统，例如tmpfs(linux)：
client_body_temp_path /dev/shm/client_body_temp;
fastcgi_finish_request()</p>
<p>范围：php 函数
类型：优化
这个特性可以提高一些 php 请求的处理速度。如果有些处理可以在页面生成完后进行，就可以使用这种优化。比如，在 memcached 中保存 session 就可以在页面交给 web server 后进行。fastcgi_finisth_request() ，这一特性可以结束响应输出，web server 可以立即开始交给等不及的客户端，而此刻，php 可以在请求的上下文环境中处理许多事情。比如保存session，转换上传的视频，处理统计等等。
fastcgi_finisth_request() 会触发 shutdown 函数运行。
request_slowlog_timeout</p>
<p>范围: php-fpm.conf 选项
分类: 方便
这个选项能让你跟踪执行缓慢的脚本并把他们连同调用栈一起记录再日志文件中。例如如下设置：
5s
logs/slow.log
记录的 slow.log 可能是这个样子：</p>
<pre><code><figure class="highlight"><pre>Sep <span class="number">21</span> <span class="number">16</span>:<span class="number">22</span>:<span class="number">19.399162</span> pid <span class="number">29715</span> (pool <span class="keyword">default</span>)
script_filename =  /local/www/stable/www/catalogue<span class="variable">.php</span>
[<span class="number">0x00007fff23618120</span>] mysql_query()  /srv/stable/common/Database/<span class="built_in">class</span><span class="variable">.MySQLRequest</span><span class="variable">.php</span>:<span class="number">20</span>
[<span class="number">0x00007fff23618560</span>]  getResult() /srv/stable/common/Database/<span class="built_in">class</span><span class="variable">.Facade</span><span class="variable">.php</span>:<span class="number">106</span>
[<span class="number">0x00007fff23618aa0</span>] query()  /srv/stable/common/mysite<span class="variable">.com</span>/ORM/<span class="built_in">class</span><span class="variable">.UsersMapper</span><span class="variable">.php</span>:<span class="number">99</span>
[<span class="number">0x00007fff23618d60</span>] resolveByID()  /srv/stable/common/mysite<span class="variable">.com</span>/ORM/<span class="built_in">class</span><span class="variable">.User</span><span class="variable">.php</span>:<span class="number">629</span>
[<span class="number">0x00007fff236193b0</span>]  getData() /srv/stable/common/<span class="built_in">class</span><span class="variable">.DataEntity</span><span class="variable">.php</span>:<span class="number">90</span>
[<span class="number">0x00007fff236195d0</span>]  load() /srv/stable/common/mysite<span class="variable">.com</span>/ORM/<span class="built_in">class</span><span class="variable">.User</span><span class="variable">.php</span>:<span class="number">587</span>
[<span class="number">0x00007fff23619a00</span>] getIsHidden()  /srv/stable/common/mysite<span class="variable">.com</span>/<span class="built_in">class</span><span class="variable">.User</span><span class="variable">.php</span>:<span class="number">42</span>
[<span class="number">0x00007fff2361a470</span>]  getName() /local/www/stable/www/catalogue<span class="variable">.php</span>:<span class="number">41</span>
</pre></figure></code></pre>
<p>同时，在 error.log 中保存了如下记录：
Sep 21 16:22:19.399031 [WARNING] fpm_request_check_timed_out(), line 135:  child 29715, script &#39;/local/www/stable/www/catalogue.php&#39; (pool default)  executing too slow (5.018002 sec), logging
正如你再例子中看到的，脚本运行了 5 秒以上，并很可能是由于 mysql 响应慢造成的（top backtrace）。</p>
<p>FAQ
Q：php-fpm 可以和 ZendOptimize 一起用吗？
A：完全可以。</p>
<p>Q：php-fpm 可以和 ZendPlatform、xcache、eAccelerator、APC 等的优化器一起用吗？
A：是的。php-fpm 的架构和任何一种用于高速 opcode 缓存的共享内存都适用。唯一的限制是：所有的 worker 进程只能适用一个缓存，即使它们用不同的 uid/gid 运行</p>
<p>Q：为什么我要给 php 打补丁呢？spawn-fcgi 不需要这样！
A：php-fpm 的创建是为了增强方便管理。没有打过补丁的 php 不能做到：
平滑重启 php 而不丢失请求，包括升级 php 二进制文件 以及/或者 扩展。
用不同的 uid / gid / chroot 环境运行 worker 进程
所有的设置只有一个配置文件
根据负载动态请求 （TODO）
对 php 请求实时统计性能 （TODO）</p>
<p>Q：为什么要用 root 运行 php-fpm 呢？这安全吗？
A：用 root 启动 php-fpm 只有在你打算用不同 uid/gid 的 php 来处理请求时才有意义。比如，在共享主机上的不同站点。因为只有在 master 进程用 root 运行的时候，才可以建立不同 uid/gid 的子进程。这是相当安全的。master 进程自己从来不会去处理请求。
在任何情况下，php- fpm 都不会用 root 身份来处理请求。</p>
<p>Q：php-fpm 可以加速 php 脚本处理速度吗？
A：不，它不会影响处理速度。不过，如果你使用一些特殊特性，对于一些特定的请求还是可以有性能提升的。</p>
<p>Q：如果我把我的网站从 mod_php 迁移到 php-fpm ，我会得到性能提升吗？
A：通常，当有服务器上有大量空闲内存可用时，能从迁移到 php-fpm 中得到的性能提升可能不大。但是如果内存并不充裕，性能提升还是很可观的，在某些情况下可以达到 300-500%。这可能是由于 nginx + php-fpm 一般会比 Apache + mod_php 使用更少的内存。而且 VFS 缓存会由于更多的空余内存而更有效地工作。</p>
<p>Q：php- fpm 将来会被官方的 php 包含吗？
A：我希望如此。目前，php-fpm 代码的协议是 GPL 。所以现在 php-fpm 的代码与 php 协议（类似 bsd）并不匹配。这是临时性措施。这样的选择是为了简化开发过程。一旦代码的功能完备，比如自适应生成子进程和其他一些东西，协议会改为一个相匹配的。 之后，php-fpm 会正式发布给 php 开发团队，并被建议包含。
邮件列表
如果你有问题的话，请不要犹豫在邮件组里写邮件。
English: highload-php-en Russian: highload-php-ru</p>
<p>文档
php-fpm 已经在 Linux、MacOSX、Solaris 和 FreeBSD 上测试通过。
确信 libxml2（在某些系统上叫做libxml2-devel）已经安装。</p>
<p>下载最小的 php 和 php-fpm
$ bzip2 -cd php-5.2.5.tar.bz2 | tar xf -
$ gzip -cd php-5.2.5-fpm-0.5.7.diff.gz | patch -d php-5.2.5 -p1
$ cd php-5.2.5
$ ./configure --enable-fastcgi --enable-fpm
$ make all install
编辑
$prefix/etc/php-fpm.conf
运行
$prefix/bin/php-cgi --fpm
仔细检查
$prefix/logs/php-fpm.log
运行 phpinfo() 检查你的网站是否还正常运行
master 进程的 pid 被存放在
$prefix/logs/php-fpm.pid
master进程可以理解以下信号：
SIGINT, SIGTERM
立刻终止
SIGQUIT
平滑终止
SIGUSR1
重新打开日志文件
SIGUSR2
平滑重载所有worker进程并重新载入配置和二进制</p>
<p>关于
嗨，我的名字叫 Andrei Nigmatulin， 我是 php-fpm 的作者。
从 2004 年开始，我就在等有什么人让 PHP FastCGI 能满足产品环境，但我等不下去了。
php-fpm 是在数个项目种使用 PHP 的 FastCGI SAPI 中的知识、经验和想法的产物。
php-fpm 可以在 GPL 协议下用在公共用途。和 php-fpm 绑定的修改版的 libevent 是在 BSD 协议下发布的。
我需要得到您的反馈——新的想法和建议——来改进和优化 php FastCGI SAPI。 如果您有什么想法、意见、补充和建议，我会很高兴，很原意听取，也许还会实现他们。给给我发邮件吧。（地址在本页的末尾）。</p>
<p>如果你想支持 php-fpm 的开发，可以作一些捐赠： Paypal Yandex.Money
15/05/2007 - 第一次提交到 php-fpm.
andrei dot nigmatulin at gmail dot com</p>
<p>译注：
php-fpm还带有一个更方便的脚本，在$prefix/sbin/php-fpm。可以用php-fpm start|graceful|restart|stop来维护。稍编辑一下就可以让它使用配置文件。
后记：
最开始，php-fpm 只有俄文文档，弄的我很郁闷，于是我先用 google 翻译先弄成英文，然后再人工翻成中文。这当中会难免会在我自己的英文水平引起的错误之外，再多些错误出来。后来终于有了一个英文的 wiki，并邀请我提供中文翻译。同时，距上一次翻译（2008年5月）以后，原来的文档也已经有了更新。于是我就根据英文 wiki ，重新翻译了一遍。</p>
<p>源文档 <a href="http://www.opendoc.com.cn/webserver/php-fpm%E8%AF%A6%E8%A7%A3.html">http://www.opendoc.com.cn/webserver/php-fpm%E8%AF%A6%E8%A7%A3.html</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-17T23:41:40.000Z"><a href="/2010/12/18/centos-yum-nginx-php-fpm-mysql/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/centos-yum-nginx-php-fpm-mysql/">Centos Yum Nginx Php-fpm Mysql</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今天发现了个好东西
<a href="http://centos.alt.ru/pub/repository/centos/5/i386/">http://centos.alt.ru/pub/repository/centos/5/i386/</a>
<a href="http://centos.alt.ru/pub/repository/centos/5/x86_64/">http://centos.alt.ru/pub/repository/centos/5/x86_64/</a>
现在，我们可以快速全自动搞定 CentOS + Nginx + PHP-FPM + MySQL 的安装了</p>
<p>先新建一个 repo</p>
<h1>vi /etc/yum.repos.d/alt.ru.repo</h1>
<pre><code><figure class="highlight"><pre><span class="title">[CentALT]</span>
<span class="setting">name=<span class="value">CentALT Packages for Enterprise Linux <span class="number">5</span> - $basearch</span></span>
<span class="setting">baseurl=<span class="value">http://centos.alt.ru/repository/centos/<span class="number">5</span>/$basearch/</span></span>
<span class="setting">enabled=<span class="value"><span class="number">1</span></span></span>
<span class="setting">gpgcheck=<span class="value"><span class="number">0</span></span></span>
<span class="setting">protect=<span class="value"><span class="number">1</span></span></span>
</pre></figure></code></pre>
<p>启用 EPEL repo
i386
rpm -ihv <a href="http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-3.noarch.rpm">http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-3.noarch.rpm</a>
x86_64
rpm -ihv <a href="http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-3.noarch.rpm">http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-3.noarch.rpm</a>
好了，一键安装</p>
<h1>yum install nginx php-fpm mysql mysql-server</h1>
<p>爽吧！</p>
<p>更完整的安装
yum -y update
yum -y mysql mysql-server
mysqladmin -u root password root
yum -y install nginx php-fpm php-cli php-pdo php-mysql php-mcrypt php-mbstring php-gd php-tidy php-xml php-xmlrpc php-pear php-pecl-memcache php-eaccelerator</p>
<h1>APC 和 eAccelerator 有冲突，2选1</h1>
<p>yum -y install php-pecl-apc</p>
<p>看下我的完整安装，只要一句
yum -y install nginx mysql mysql-server php-fpm php-cli php-pdo php-mysql php-mcrypt php-mbstring php-gd php-tidy php-xml php-xmlrpc php-pear php-pecl-memcache php-eaccelerator</p>
<p>引用：<a href="http://www.21andy.com/blog/20100219/1703.html">http://www.21andy.com/blog/20100219/1703.html</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-17T23:38:06.000Z"><a href="/2010/12/18/eaccelerator-config-explanation/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/eaccelerator-config-explanation/">eAccelerator 配置参数详解</a></h1>
  

    </header>
    <div class="entry">
      
        <p>eaccelerator.shm_size=&quot;32&quot;
eAccelerator 可以使用的共享内存的数量 (以兆为单位) . &quot;0&quot; 是指操作系统的默认值. 默认值是 &quot;0&quot;.可根据服务器的实际情况来调整，16，32，64，128都是可以的。</p>
<p>eaccelerator.cache_dir=&quot;/home/php/tmp&quot;
这个目录是给磁盘缓存使用. eAccelerator 在这里储存预先编译好的代码, 进程数据, 内容以及用户的自定义内容. 同样的数据也能被储存在共享内存中 (这样可以提高访问速度). 默认的设置是 &quot;/tmp/eaccelerator&quot;.</p>
<p>eaccelerator.enable=&quot;1&quot;
开启或关闭 eAccelerator。&quot;1&quot; 为开启，&quot;0&quot; 为关闭。默认值为 &quot;1&quot;。</p>
<p>eaccelerator.optimizer=&quot;1&quot;
启或关闭内部优化器，可以提升代码执行速度。&quot;1&quot; 为开启，&quot;0&quot; 为关闭。默认值为 &quot;1&quot;。</p>
<p>eaccelerator.check_mtime=&quot;1&quot;
打开或者关闭 PHP 的文件修改检查. &quot;1&quot; 是指打开, &quot;0&quot; 是指关闭. 如果您在修改以后重新编译 PHP 的文件,那么您应当设置为 &quot;1&quot;. 默认值是 &quot;1&quot;.</p>
<p>eaccelerator.debug=&quot;0&quot;
开启或关闭调试日志记录。&quot;1&quot; 为开启，&quot;0&quot; 为关闭。默认值为 &quot;0&quot;。会将缓存命中得记录写入日志。</p>
<p>eaccelerator.filter=&quot;&quot;
判断哪些 PHP 文件必须缓存。您可以指定缓存和不缓存的文件类型（如 &quot;<em>.php </em>.phtml&quot;等）
如果参数以 &quot;!&quot; 开头，则匹配这些参数的文件被忽略缓存。默认值为 &quot;&quot;，即，所有 PHP 文件都将被缓存。</p>
<p>eaccelerator.shm_max=&quot;0&quot;
当使用 &quot; eaccelerator_put() &quot; 函数时禁止其向共享内存中存储过大的文件。该参数指定允许存储的最大值，单位：字节 (10240, 10K, 1M)。&quot;0&quot; 为不限制。默认值为 &quot;0&quot;。
eaccelerator.shm_ttl=&quot;0&quot;
当 eAccelerator 获取新脚本的共享内存大小失败时，它将从共享内存中删除所有在最后 &quot;shm_ttl&quot; 秒内没有存取的脚本缓存。默认值为 &quot;0&quot;，即：不从共享内春中删除任何缓存文件。
eaccelerator.shm_prune_period=&quot;0&quot;
当 eAccelerator 获取新脚本的共享内存大小失败时，他将试图从共享内存中删除早于&quot;shm_prune_period&quot; 秒的缓存脚本。默认值为 &quot;0&quot;，即：不从共享内春中删除任何缓存文件。</p>
<p>eaccelerator.shm_only=&quot;0&quot;
允许或禁止将已编译脚本缓存在磁盘上。该选项对 session 数据和内容缓存无效。默认值为 &quot;0&quot;，即：使用磁盘和共享内存进行缓存。</p>
<p>eaccelerator.compress=&quot;1&quot;
允许或禁止压缩内容缓存。默认值为 &quot;1&quot;，即：允许压缩。</p>
<p>eaccelerator.compress_level=&quot;9&quot;
指定内容缓存的压缩等级。默认值为 &quot;9&quot;，为最高等级。</p>
<p>eaccelerator.keys = &quot;disk_only&quot;
eaccelerator.session = &quot;disk_only&quot;
eaccelerator.content = &quot;disk_only&quot;
设置内容缓存的存放的地方，可以设置为：
shm_and_disk 在共享缓存和硬盘(默认值)
shm 默认存在共享内存，如果共享内存已满或大小超过 &quot;eaccelerator.shm_max&quot; 的值，就存到硬盘
shm_only 只存放在共享内存
disk_only 只存放在硬盘
none 不缓存数据</p>
<p>eaccelerator.allowed_admin_path = &quot;/var/www/html/21andy.com/eaccelerator&quot;
这是控制面板的地址
安装包里有个control.php，你把它复制到网站的任意目录，可以用它查看和管理，这个必须指定，否则查看缓存内容的时候会出错
最后，来看一下我的 eAccelerator 设置</p>
<pre><code><figure class="highlight"><pre>; eaccelerator 
[eaccelerator] 
<span class="title">zend_extension</span>=<span class="string">"/usr/local/php/lib/php/extensions/no-debug-non-zts-20060613/eaccelerator.so"</span> 
<span class="title">eaccelerator</span>.shm_size=<span class="string">"128"</span> 
<span class="title">eaccelerator</span>.cache_dir=<span class="string">"/tmp/eaccelerator"</span> 
<span class="title">eaccelerator</span>.enable=<span class="string">"1"</span> 
<span class="title">eaccelerator</span>.optimizer=<span class="string">"1"</span> 
<span class="title">eaccelerator</span>.check_mtime=<span class="string">"1"</span> 
<span class="title">eaccelerator</span>.debug=<span class="string">"0"</span> 
<span class="title">eaccelerator</span>.filter=<span class="string">""</span> 
<span class="title">eaccelerator</span>.shm_max=<span class="string">"0"</span> 
<span class="title">eaccelerator</span>.shm_ttl=<span class="string">"3600"</span> 
<span class="title">eaccelerator</span>.shm_prune_period=<span class="string">"3600"</span> 
<span class="title">eaccelerator</span>.shm_only=<span class="string">"0"</span> 
<span class="title">eaccelerator</span>.compress=<span class="string">"1"</span> 
<span class="title">eaccelerator</span>.compress_level=<span class="string">"9"</span> 
<span class="title">eaccelerator</span>.keys = <span class="string">"disk_only"</span> 
<span class="title">eaccelerator</span>.sessions = <span class="string">"disk_only"</span> 
<span class="title">eaccelerator</span>.content = <span class="string">"disk_only"</span> 
<span class="title">eaccelerator</span>.allowed_admin_path = <span class="string">"/var/www/html/21andy.com/eaccelerator"</span> 
</pre></figure></code></pre>
<p>另外，再说下 eAccelerator 的安装</p>
<h1>wget <a href="http://bart.eaccelerator.net/source/0.9.6/eaccelerator-0.9.6.tar.bz2">http://bart.eaccelerator.net/source/0.9.6/eaccelerator-0.9.6.tar.bz2</a></h1>
<h1>tar -jxvf eaccelerator-0.9.6.tar.bz2</h1>
<h1>cd eaccelerator-0.9.6</h1>
<h1>/usr/local/php/bin/phpize</h1>
<h1>./configure --enable-eaccelerator=shared --with-php-config=/usr/local/php/bin/php-config</h1>
<h1>make &amp;&amp; make install</h1>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
    <a href="/archives/2010/page/4/" class="alignleft prev">上一页</a>
  
  
    <a href="/archives/2010/page/6/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:bubbyroom.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/cdn/">cdn</a><small>12</small></li>
  
    <li><a href="/categories/faq/">faq</a><small>27</small></li>
  
    <li><a href="/categories/cdn/faq/">faq</a><small>1</small></li>
  
    <li><a href="/categories/faq/howtoforge/">howtoforge</a><small>1</small></li>
  
    <li><a href="/categories/howtoforge/">howtoforge</a><small>6</small></li>
  
    <li><a href="/categories/cdn/puppet/">puppet</a><small>4</small></li>
  
    <li><a href="/categories/puppet/">puppet</a><small>2</small></li>
  
    <li><a href="/categories/cdn/分布式监控/">分布式监控</a><small>2</small></li>
  
    <li><a href="/categories/howtoforge/分布式监控/">分布式监控</a><small>2</small></li>
  
    <li><a href="/categories/分布式监控/">分布式监控</a><small>1</small></li>
  
    <li><a href="/categories/howtoforge/应用程序/">应用程序</a><small>2</small></li>
  
    <li><a href="/categories/应用程序/">应用程序</a><small>19</small></li>
  
    <li><a href="/categories/faq/数据库/">数据库</a><small>1</small></li>
  
    <li><a href="/categories/数据库/">数据库</a><small>4</small></li>
  
    <li><a href="/categories/生活乐事/">生活乐事</a><small>3</small></li>
  
    <li><a href="/categories/程序开发/">程序开发</a><small>4</small></li>
  
    <li><a href="/categories/faq/系统命令/">系统命令</a><small>2</small></li>
  
    <li><a href="/categories/系统命令/">系统命令</a><small>14</small></li>
  
    <li><a href="/categories/美图鉴赏/">美图鉴赏</a><small>1</small></li>
  
    <li><a href="/categories/应用程序/负载均衡/">负载均衡</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/1032/">1032</a><small>1</small></li>
  
    <li><a href="/tags/1236/">1236</a><small>1</small></li>
  
    <li><a href="/tags/403/">403</a><small>1</small></li>
  
    <li><a href="/tags/Cache-control/">Cache-control</a><small>2</small></li>
  
    <li><a href="/tags/Cluster-bacst/">Cluster-bacst</a><small>1</small></li>
  
    <li><a href="/tags/E752x/">E752x</a><small>1</small></li>
  
    <li><a href="/tags/Header-V3-DSA-signature/">Header V3 DSA signature</a><small>1</small></li>
  
    <li><a href="/tags/Python-Imaging-Library/">Python Imaging Library</a><small>1</small></li>
  
    <li><a href="/tags/object-Object/">[object Object]</a><small>1</small></li>
  
    <li><a href="/tags/acl/">acl</a><small>2</small></li>
  
    <li><a href="/tags/allcommands/">allcommands</a><small>1</small></li>
  
    <li><a href="/tags/apache/">apache</a><small>8</small></li>
  
    <li><a href="/tags/arp/">arp</a><small>1</small></li>
  
    <li><a href="/tags/awk/">awk</a><small>4</small></li>
  
    <li><a href="/tags/bash/">bash</a><small>2</small></li>
  
    <li><a href="/tags/best/">best</a><small>1</small></li>
  
    <li><a href="/tags/binding/">binding</a><small>1</small></li>
  
    <li><a href="/tags/binlog/">binlog</a><small>1</small></li>
  
    <li><a href="/tags/bnx2/">bnx2</a><small>1</small></li>
  
    <li><a href="/tags/browser/">browser</a><small>1</small></li>
  
    <li><a href="/tags/cache/">cache</a><small>1</small></li>
  
    <li><a href="/tags/cdn/">cdn</a><small>2</small></li>
  
    <li><a href="/tags/centos/">centos</a><small>8</small></li>
  
    <li><a href="/tags/chmod/">chmod</a><small>1</small></li>
  
    <li><a href="/tags/chown/">chown</a><small>1</small></li>
  
    <li><a href="/tags/commands/">commands</a><small>1</small></li>
  
    <li><a href="/tags/content/">content</a><small>1</small></li>
  
    <li><a href="/tags/cpan/">cpan</a><small>1</small></li>
  
    <li><a href="/tags/cpanm/">cpanm</a><small>1</small></li>
  
    <li><a href="/tags/creating/">creating</a><small>1</small></li>
  
    <li><a href="/tags/dashboard/">dashboard</a><small>1</small></li>
  
    <li><a href="/tags/dell/">dell</a><small>1</small></li>
  
    <li><a href="/tags/diff/">diff</a><small>1</small></li>
  
    <li><a href="/tags/dstat/">dstat</a><small>1</small></li>
  
    <li><a href="/tags/du/">du</a><small>1</small></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator</a><small>1</small></li>
  
    <li><a href="/tags/end/">end</a><small>1</small></li>
  
    <li><a href="/tags/epel/">epel</a><small>1</small></li>
  
    <li><a href="/tags/etag/">etag</a><small>1</small></li>
  
    <li><a href="/tags/expires/">expires</a><small>1</small></li>
  
    <li><a href="/tags/find/">find</a><small>1</small></li>
  
    <li><a href="/tags/for-1/">for</a><small>1</small></li>
  
    <li><a href="/tags/foreman/">foreman</a><small>1</small></li>
  
    <li><a href="/tags/ftp/">ftp</a><small>1</small></li>
  
    <li><a href="/tags/ganglia/">ganglia</a><small>2</small></li>
  
    <li><a href="/tags/gmond/">gmond</a><small>1</small></li>
  
    <li><a href="/tags/group/">group</a><small>1</small></li>
  
    <li><a href="/tags/groupadd/">groupadd</a><small>1</small></li>
  
    <li><a href="/tags/gzip/">gzip</a><small>1</small></li>
  
    <li><a href="/tags/howto/">howto</a><small>2</small></li>
  
    <li><a href="/tags/http_realip_module/">http_realip_module</a><small>1</small></li>
  
    <li><a href="/tags/ideauthority/">ideauthority</a><small>1</small></li>
  
    <li><a href="/tags/if/">if</a><small>2</small></li>
  
    <li><a href="/tags/ifconfig/">ifconfig</a><small>1</small></li>
  
    <li><a href="/tags/ignore/">ignore</a><small>1</small></li>
  
    <li><a href="/tags/init/">init</a><small>1</small></li>
  
    <li><a href="/tags/iostat/">iostat</a><small>2</small></li>
  
    <li><a href="/tags/ip-1/">ip</a><small>1</small></li>
  
    <li><a href="/tags/iptables/">iptables</a><small>1</small></li>
  
    <li><a href="/tags/jk/">jk</a><small>1</small></li>
  
    <li><a href="/tags/kcore/">kcore</a><small>1</small></li>
  
    <li><a href="/tags/kernel/">kernel</a><small>1</small></li>
  
    <li><a href="/tags/kick/">kick</a><small>1</small></li>
  
    <li><a href="/tags/libmemcached/">libmemcached</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>18</small></li>
  
    <li><a href="/tags/lsof/">lsof</a><small>1</small></li>
  
    <li><a href="/tags/lvs/">lvs</a><small>1</small></li>
  
    <li><a href="/tags/master/">master</a><small>2</small></li>
  
    <li><a href="/tags/metric/">metric</a><small>1</small></li>
  
    <li><a href="/tags/mod_cband/">mod_cband</a><small>1</small></li>
  
    <li><a href="/tags/mod_limitipconn/">mod_limitipconn</a><small>1</small></li>
  
    <li><a href="/tags/moinmoin/">moinmoin</a><small>1</small></li>
  
    <li><a href="/tags/monitoring/">monitoring</a><small>1</small></li>
  
    <li><a href="/tags/moudles/">moudles</a><small>1</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>6</small></li>
  
    <li><a href="/tags/nagios/">nagios</a><small>1</small></li>
  
    <li><a href="/tags/netstat/">netstat</a><small>2</small></li>
  
    <li><a href="/tags/nginx/">nginx</a><small>4</small></li>
  
    <li><a href="/tags/optimization/">optimization</a><small>1</small></li>
  
    <li><a href="/tags/packet/">packet</a><small>1</small></li>
  
    <li><a href="/tags/pam/">pam</a><small>1</small></li>
  
    <li><a href="/tags/per-fcgi/">per-fcgi</a><small>1</small></li>
  
    <li><a href="/tags/perl/">perl</a><small>1</small></li>
  
    <li><a href="/tags/permission/">permission</a><small>1</small></li>
  
    <li><a href="/tags/php-1/">php</a><small>2</small></li>
  
    <li><a href="/tags/php-fpm/">php-fpm</a><small>2</small></li>
  
    <li><a href="/tags/pil/">pil</a><small>1</small></li>
  
    <li><a href="/tags/port/">port</a><small>1</small></li>
  
    <li><a href="/tags/practices/">practices</a><small>1</small></li>
  
    <li><a href="/tags/proftpd/">proftpd</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>2</small></li>
  
    <li><a href="/tags/ps/">ps</a><small>2</small></li>
  
    <li><a href="/tags/puppet/">puppet</a><small>6</small></li>
  
    <li><a href="/tags/puppetrun/">puppetrun</a><small>1</small></li>
  
    <li><a href="/tags/python-1/">python</a><small>3</small></li>
  
    <li><a href="/tags/python26/">python2.6</a><small>1</small></li>
  
    <li><a href="/tags/quick/">quick</a><small>1</small></li>
  
    <li><a href="/tags/r410/">r410</a><small>1</small></li>
  
    <li><a href="/tags/r710/">r710</a><small>1</small></li>
  
    <li><a href="/tags/raw/">raw</a><small>1</small></li>
  
    <li><a href="/tags/referer/">referer</a><small>1</small></li>
  
    <li><a href="/tags/replicate/">replicate</a><small>1</small></li>
  
    <li><a href="/tags/repo/">repo</a><small>1</small></li>
  
    <li><a href="/tags/resources/">resources</a><small>1</small></li>
  
    <li><a href="/tags/rhel/">rhel</a><small>1</small></li>
  
    <li><a href="/tags/rpmbuild/">rpmbuild</a><small>1</small></li>
  
    <li><a href="/tags/rpmcreate/">rpmcreate</a><small>1</small></li>
  
    <li><a href="/tags/ruby/">ruby</a><small>1</small></li>
  
    <li><a href="/tags/sar/">sar</a><small>1</small></li>
  
    <li><a href="/tags/scribe/">scribe</a><small>2</small></li>
  
    <li><a href="/tags/sed/">sed</a><small>4</small></li>
  
    <li><a href="/tags/sedline/">sedline</a><small>1</small></li>
  
    <li><a href="/tags/sending/">sending</a><small>1</small></li>
  
    <li><a href="/tags/sendmail/">sendmail</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>2</small></li>
  
    <li><a href="/tags/shtml/">shtml</a><small>1</small></li>
  
    <li><a href="/tags/slave/">slave</a><small>2</small></li>
  
    <li><a href="/tags/smartctl/">smartctl</a><small>1</small></li>
  
    <li><a href="/tags/smokeping/">smokeping</a><small>1</small></li>
  
    <li><a href="/tags/spec/">spec</a><small>2</small></li>
  
    <li><a href="/tags/squid/">squid</a><small>1</small></li>
  
    <li><a href="/tags/ssi/">ssi</a><small>1</small></li>
  
    <li><a href="/tags/system/">system</a><small>1</small></li>
  
    <li><a href="/tags/tar/">tar</a><small>1</small></li>
  
    <li><a href="/tags/tcpdump/">tcpdump</a><small>2</small></li>
  
    <li><a href="/tags/tomcat/">tomcat</a><small>4</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>1</small></li>
  
    <li><a href="/tags/top/">top</a><small>1</small></li>
  
    <li><a href="/tags/tree/">tree</a><small>1</small></li>
  
    <li><a href="/tags/ubuntu/">ubuntu</a><small>4</small></li>
  
    <li><a href="/tags/upgrade/">upgrade</a><small>1</small></li>
  
    <li><a href="/tags/user/">user</a><small>2</small></li>
  
    <li><a href="/tags/useradd/">useradd</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>2</small></li>
  
    <li><a href="/tags/vmstat/">vmstat</a><small>2</small></li>
  
    <li><a href="/tags/vsftpd/">vsftpd</a><small>1</small></li>
  
    <li><a href="/tags/while/">while</a><small>1</small></li>
  
    <li><a href="/tags/wiki/">wiki</a><small>1</small></li>
  
    <li><a href="/tags/windows7/">windows7</a><small>1</small></li>
  
    <li><a href="/tags/winsxs/">winsxs</a><small>1</small></li>
  
    <li><a href="/tags/wordpress/">wordpress</a><small>1</small></li>
  
    <li><a href="/tags/yum/">yum</a><small>10</small></li>
  
    <li><a href="/tags/zabbix/">zabbix</a><small>1</small></li>
  
    <li><a href="/tags/一句话命令/">一句话命令</a><small>1</small></li>
  
    <li><a href="/tags/主从配置/">主从配置</a><small>1</small></li>
  
    <li><a href="/tags/优化/">优化</a><small>1</small></li>
  
    <li><a href="/tags/内核/">内核</a><small>1</small></li>
  
    <li><a href="/tags/分布式/">分布式</a><small>1</small></li>
  
    <li><a href="/tags/分布式监控/">分布式监控</a><small>1</small></li>
  
    <li><a href="/tags/单引号/">单引号</a><small>1</small></li>
  
    <li><a href="/tags/参考/">参考</a><small>1</small></li>
  
    <li><a href="/tags/双引号/">双引号</a><small>1</small></li>
  
    <li><a href="/tags/命令详解/">命令详解</a><small>7</small></li>
  
    <li><a href="/tags/对比/">对比</a><small>1</small></li>
  
    <li><a href="/tags/性能优化/">性能优化</a><small>1</small></li>
  
    <li><a href="/tags/日志/">日志</a><small>2</small></li>
  
    <li><a href="/tags/环境变量/">环境变量</a><small>1</small></li>
  
    <li><a href="/tags/硬件中断/">硬件中断</a><small>1</small></li>
  
    <li><a href="/tags/管理/">管理</a><small>1</small></li>
  
    <li><a href="/tags/系统命令/">系统命令</a><small>1</small></li>
  
    <li><a href="/tags/系统管理技巧/">系统管理技巧</a><small>1</small></li>
  
    <li><a href="/tags/网卡丢包/">网卡丢包</a><small>1</small></li>
  
    <li><a href="/tags/网卡驱动/">网卡驱动</a><small>1</small></li>
  
    <li><a href="/tags/老板/">老板</a><small>1</small></li>
  
    <li><a href="/tags/认证/">认证</a><small>1</small></li>
  
    <li><a href="/tags/详解/">详解</a><small>3</small></li>
  
    <li><a href="/tags/过滤日志/">过滤日志</a><small>1</small></li>
  
    <li><a href="/tags/集中化管理/">集中化管理</a><small>1</small></li>
  
    <li><a href="/tags/面试题/">面试题</a><small>1</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 Liu Yu
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>