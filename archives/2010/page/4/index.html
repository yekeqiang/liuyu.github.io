<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 4 页 | 归档：2010 | Puppet-in-action</title>
  <meta name="author" content="Liu Yu">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Puppet-in-action"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Puppet-in-action" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Puppet-in-action</a></h1>
  <h2><a href="/">Puppet</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title">2010</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T23:32:25.000Z"><a href="/2010/12/19/rhel-use-centos-yum/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/rhel-use-centos-yum/">rhel howto use centos yum ?</a></h1>
  

    </header>
    <div class="entry">
      
        <p>rhel服务器可以使用yum更新，但需要先卸载原先的yum，并且安装新的yum，然后可以更新。</p>
<p>1 卸载原先的yum
rpm -aq|grep yum|xargs rpm -e --nodeps
如果有卸载不了的，试试 --nodeps
如果是定义的安装包，试试 --allmatches</p>
<p>2 下载新的yum，并且安装</p>
<pre><code><figure class="highlight"><pre>wget http://centos<span class="preprocessor">.ustc</span><span class="preprocessor">.edu</span><span class="preprocessor">.cn</span>/centos/<span class="number">5.3</span>/os/i386/CentOS/yum-<span class="number">3.2</span><span class="number">.19</span>-<span class="number">18.</span>el5<span class="preprocessor">.centos</span><span class="preprocessor">.noarch</span><span class="preprocessor">.rpm</span>
wget http://centos<span class="preprocessor">.ustc</span><span class="preprocessor">.edu</span><span class="preprocessor">.cn</span>/centos/<span class="number">5.3</span>/os/i386/CentOS/yum-metadata-parser-<span class="number">1.1</span><span class="number">.2</span>-<span class="number">2.</span>el5<span class="preprocessor">.i</span>386<span class="preprocessor">.rpm</span>
wget http://mirror<span class="preprocessor">.centos</span><span class="preprocessor">.org</span>/centos-<span class="number">5</span>/<span class="number">5.3</span>/os/i386/CentOS/yum-fastestmirror-<span class="number">1.1</span><span class="number">.16</span>-<span class="number">13.</span>el5<span class="preprocessor">.centos</span><span class="preprocessor">.noarch</span><span class="preprocessor">.rpm</span>
rpm -ivh yum-*`&lt;/pre&gt;

<span class="number">4</span> 更改yum源
&lt;pre&gt;`cd /etc/yum<span class="preprocessor">.repos</span><span class="preprocessor">.d</span>/
wget http://docs<span class="preprocessor">.linuxtone</span><span class="preprocessor">.org</span>/soft/lemp/CentOS-Base<span class="preprocessor">.repo</span>`&lt;/pre&gt;

注：别的 centos源要把repo文件里的 $releasever 换成版本号，比如换成<span class="number">5</span>
引用
&lt;pre&gt;`baseurl=http://centos<span class="preprocessor">.ustc</span><span class="preprocessor">.edu</span><span class="preprocessor">.cn</span>/centos/$releasever/os/$basearch/
变成：
baseurl=http://centos<span class="preprocessor">.ustc</span><span class="preprocessor">.edu</span><span class="preprocessor">.cn</span>/centos/<span class="number">5</span>/os/$basearch/
</pre></figure></code></pre>
<p>5 全部更新
yum -y update</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T23:30:14.000Z"><a href="/2010/12/19/vim-editor-save-file-without-root-permission/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/vim-editor-save-file-without-root-permission/">vi编辑文件保存时没有root权限</a></h1>
  

    </header>
    <div class="entry">
      
        <p>使用普通用户编辑nginx.conf 等配置文件：</p>
<p><a href="http://bubbyroom.com/wp-content/uploads/2010/12/vim-not-root-1.jpg"><img src="http://bubbyroom.com/wp-content/uploads/2010/12/vim-not-root-1.jpg" alt="" title="vim-not-root-1"></a></p>
<p>保存的时候会提示：没有Root Permission
可以用如下方法解决：
保存时加上：
:w !sudo tee %</p>
<p><a href="http://bubbyroom.com/wp-content/uploads/2010/12/vim-not-root-2.jpg"><img src="http://bubbyroom.com/wp-content/uploads/2010/12/vim-not-root-2.jpg" alt="" title="vim-not-root-2"></a></p>
<p>我这里有一个问题。没有配置sudo权限。
用sudo时提示&quot;xxx is not in the sudoers file. This incident will be reported.其中XXX是你的用户名，也就是你的用户名没有权限使用sudo,我们只要修改一下/etc/sudoers文件就行了。下面是修改方 法：
1）进入超级用户模式。也就是输入&quot;su -&quot;,系统会让你输入超级用户密码，输入密码后就进入了超级用户模式。（当然，你也可以直接用root用）
2）添加文件的写权限。也就是输入命令&quot;chmod u+w /etc/sudoers&quot;。
3）编辑/etc/sudoers文件。也就是输入命令&quot;vim /etc/sudoers&quot;,输入&quot;i&quot;进入编辑模式，找到这一 行：&quot;root ALL=(ALL) ALL&quot;在起下面添加&quot;xxx ALL=(ALL) ALL&quot;(这里的xxx是你的用户名)，然后保存（就是先按一 下Esc键，然后输入&quot;:wq&quot;）退出。
4）撤销文件的写权限。也就是输入命令&quot;chmod u-w /etc/sudoers&quot;。
再次保存：</p>
<p><a href="http://bubbyroom.com/wp-content/uploads/2010/12/vim-not-root-3.jpg"><img src="http://bubbyroom.com/wp-content/uploads/2010/12/vim-not-root-3.jpg" alt="" title="vim-not-root-3"></a></p>
<p>查看是否成功：
$ grep sudo nginx.conf</p>
<h1>test :w !sudo tee %</h1>
<p>参考：<a href="http://www.cyberciti.biz/faq/vim-vi-text-editor-save-file-without-root-permission/">http://www.cyberciti.biz/faq/vim-vi-text-editor-save-file-without-root-permission/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T23:16:30.000Z"><a href="/2010/12/19/linux-tools/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/linux-tools/">Linux一些工具整理</a></h1>
  

    </header>
    <div class="entry">
      
        <p>替代rsync bbcp <a href="http://www.slac.stanford.edu/~abh/bbcp/">http://www.slac.stanford.edu/~abh/bbcp/</a>
同步：<a href="http://code.google.com/p/sersync/">http://code.google.com/p/sersync/</a>
图片处理：imagemagick <a href="http://www.imagemagick.org/script/index.php">http://www.imagemagick.org/script/index.php</a>
替代品(速度快15%): GraphicsMagick <a href="http://www.graphicsmagick.org/">http://www.graphicsmagick.org/</a></p>
<p>系统管理工具：ipmitool 远程开关机并监控温度等状态
内存检测工具：kmemcheck <a href="http://www.ibm.com/developerworks/cn/linux/l-cn-kmemcheck/index.html?ca=drs-cn-1119">http://www.ibm.com/developerworks/cn/linux/l-cn-kmemcheck/index.html?ca=drs-cn-1119</a>
检测漏洞和后门：Rootkit Hunter和Chkrootkit
性能测试工具：sysbench <a href="http://www.ningoo.net/html/2009/performance_test_tool_sysbench.html">http://www.ningoo.net/html/2009/performance_test_tool_sysbench.html</a>
网络备份工具: bacula
测试硬盘性能：iozone</p>
<p>linux分区修复软件: Testdisk <a href="http://www.php-oa.com/2009/02/13/testdisk.html">http://www.php-oa.com/2009/02/13/testdisk.html</a>
用Google App Engine做个人代理服务器：<a href="http://blog.chinaunix.net/u/249/showart.php?id=2212119">http://blog.chinaunix.net/u/249/showart.php?id=2212119</a></p>
<p>INNODB备份：xtrabackup
MySQL 优化工具 MySQLTuner <a href="http://github.com/rackerhacker/MySQLTuner-perl">http://github.com/rackerhacker/MySQLTuner-perl</a>
MySQL 监控工具 mytop <a href="http://jeremy.zawodny.com/mysql/mytop/">http://jeremy.zawodny.com/mysql/mytop/</a></p>
<p>服务器统一配置管理：Cfengine
社交网络平台上创建的免费的企业级协作套件：CubeTree （简介、活动、微博、WIKI、BLOG、共享、搜索）</p>
<p>自动化处理：
opscode <a href="http://www.opscode.com/">http://www.opscode.com/</a>
puppet <a href="http://reductivelabs.com/products/puppet/">http://reductivelabs.com/products/puppet/</a>
punc</p>
<p>集群文件系统：GlusterFS
Eucalyptus系统 Eucalyptus是一套开源系统，可构建企业内部的私有云及混合云，把电脑、网络和存储等数据中心资源纳入一朵可由IT部门控制并定制的云</p>
<p>流量：
speedometer查看流量
wget <a href="http://excess.org/speedometer/speedometer.py">http://excess.org/speedometer/speedometer.py</a>
yum install python-urwid
chmod 755 speedometer
./speedometer.py -rx eth0 -c -tx eth0</p>
<p>流量统计： piwik <a href="http://piwik.org/demo/">http://piwik.org/demo/</a>
Crash 工具分析 Linux dump 文件 <a href="http://www.ibm.com/developerworks/cn/linux/l-cn-dumpanalyse/index.html?ca=drs-cn-0329">http://www.ibm.com/developerworks/cn/linux/l-cn-dumpanalyse/index.html?ca=drs-cn-0329</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T23:15:12.000Z"><a href="/2010/12/19/tcpdump-exclude-port/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/tcpdump-exclude-port/">tcpdump过滤某个端口</a></h1>
  

    </header>
    <div class="entry">
      
        <p>TcpDump可以将网络中传送的数据包的“头”完全截获下来提供分析。它支持针对网络层、协议、主机、网络或端口的过滤，并提供 and、or、not等逻辑语句来帮助你去掉无用的信息。tcpdump就是一种免费的网络分析工具</p>
<p>一般我们使用Tcpdump时都是使用：</p>
<pre><code><figure class="highlight"><pre><span class="xml">tcpdump -i ethx `<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>
这样可以查看网卡ethx上的所有数据包传送过程，但你会发现相当的多。你都看不过来。因此我们需要过滤。

下面这条命令就是查看</span><span class="number">80</span><span class="xml">端口的访问量，进行排序，取前</span><span class="number">20</span><span class="xml">位
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`tcpdump -i eth0 -tnn dst port </span><span class="number">80</span><span class="xml"> -c </span><span class="number">1000</span><span class="xml"> | awk -F"." '{print </span><span class="variable">$1</span><span class="xml">"."</span><span class="variable">$2</span><span class="xml">"."</span><span class="variable">$3</span><span class="xml">"."</span><span class="variable">$4}</span><span class="xml">' | sort | uniq -c | sort -nr |head -</span><span class="number">20</span><span class="xml"> `<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

但也可以使用过滤某个端口的方法进行查看
如：过滤掉</span><span class="number">22</span><span class="xml">端口
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`tcpdump -i eth1  -s </span><span class="number">1500</span><span class="xml"> port not </span><span class="number">22</span><span class="xml"> `<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

过滤</span><span class="number">22</span><span class="xml">和</span><span class="number">53</span><span class="xml">
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`tcpdump -i eth1  -s </span><span class="number">1500</span><span class="xml"> port not </span><span class="number">22</span><span class="xml"> and port not </span><span class="number">53</span><span class="xml"> `<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

过滤</span><span class="number">22</span><span class="xml">并指定来源ip
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`tcpdump -i eth1 port not </span><span class="number">22</span><span class="xml"> and host </span><span class="number">1.2</span><span class="xml"></span><span class="number">.3</span><span class="xml"></span><span class="number">.4</span><span class="xml"> </span>
</pre></figure></code></pre>
<p>参考：
<a href="http://www.cyberciti.biz/faq/linux-monitor-all-network-traffic-except-ssh-port-22/">http://www.cyberciti.biz/faq/linux-monitor-all-network-traffic-except-ssh-port-22/</a>
<a href="http://www.opendoc.com.cn/linuxtools/system_command.html">http://www.opendoc.com.cn/linuxtools/system_command.html</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T23:10:49.000Z"><a href="/2010/12/19/linux-find-commands/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/linux-find-commands/">linux find查找命令大全</a></h1>
  

    </header>
    <div class="entry">
      
        <p>linux 查找文加命令，相信对初学者很有用，下面是一部分常用的linux查找命令。</p>
<p>grep命令：
grep -i pattern files ：不区分大小写地搜索。默认情况区分大小写，
grep -l pattern files ：只列出匹配的文件名，
grep -L pattern files ：列出不匹配的文件名，
grep -w pattern files ：只匹配整个单词，而不是字符串的一部分（如匹配‘magic’，而不是‘magical’），
grep -C number pattern files ：匹配的上下文分别显示[number]行，
grep pattern1 | pattern2 files ：显示匹配 pattern1 或 pattern2 的行，
grep pattern1 files | grep pattern2 ：显示既匹配 pattern1 又匹配 pattern2 的行。
example:grep -i martin@martin-desktop:~$ grep ShopAction -i notes/sql/<em> #note: </em> 不要忘记</p>
<p>find命令:
find 目录 -name 关键字</p>
<pre><code><figure class="highlight"><pre><span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">amin</span> <span class="literal">-</span><span class="comment">10</span> <span class="comment">#</span> <span class="comment">查找在系统中最后10分钟访问的文件</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">atime</span> <span class="literal">-</span><span class="comment">2</span> <span class="comment">#</span> <span class="comment">查找在系统中最后48小时访问的文件</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">empty</span> <span class="comment">#</span> <span class="comment">查找在系统中为空的文件或者文件夹</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">group</span> <span class="comment">cat</span> <span class="comment">#</span> <span class="comment">查找在系统中属于</span> <span class="comment">groupcat的文件</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">mmin</span> <span class="literal">-</span><span class="comment">5</span> <span class="comment">#</span> <span class="comment">查找在系统中最后5分钟里修改过的文件</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">mtime</span> <span class="literal">-</span><span class="comment">1</span> <span class="comment">#查找在系统中最后24小时里修改过的文件</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">nouser</span> <span class="comment">#查找在系统中属于作废用户的文件</span>
<span class="comment">find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">user</span> <span class="comment">fred</span> <span class="comment">#查找在系统中属于FRED这个用户的文件</span>
<span class="comment">find</span> <span class="string">.</span> <span class="literal">-</span><span class="comment">maxdepth</span> <span class="comment">2</span> <span class="literal">-</span><span class="comment">name</span> <span class="comment">fred
</pre></figure></code></pre>
<p>-maxdepth选项的作用就是限制find命令在目录中按照递减方式查找文件的时候搜索文件超过某个级别或者搜索过多的目录，这样导致查找速度变慢，查找花费的时间过多。例如，我们要在当前(.)目录技巧子目录中查找一个名叫fred的文件，我们可以使用如下命令</p>
<p>find / -name “php.ini” -ls
系统查找到php.ini文件后立即在屏幕上显示php.ini文件信息。</p>
<p>find 常用参数
-exec command;查找并执行命令
-fprint file;打印文件完整文件名
-fprint0 file;打印文件完整文件名包括空的文件
-fprintf file format;打印文件格式
-ok command;给用户命令执行操作，根据用户的Y 确认输入执行
-printf format;打印文件格式
-ls;打印同种文件格式的文件.</p>
<p>locate 命令
locate命令其实是“find -name”的另一种写法，但是要比后者快得多，原因在于它不搜索具体目录，而是搜索一个数据库（/var/lib/locatedb），这个数据库中含 有本地所有文件信息。Linux系统自动创建这个数据库，并且每天自动更新一次，所以使用locate命令查不到最新变动过的文件。为了避免这种情况，可 以在使用locate之前，先使用updatedb命令，手动更新数据库。</p>
<p>locate命令的使用实例：
$ locate /etc/sh
搜索etc目录下所有以sh开头的文件。
$ locate ~/m
搜索用户主目录下，所有以m开头的文件。
$ locate -i ~/m
搜索用户主目录下，所有以m开头的文件，并且忽略大小写。</p>
<p>原创文章，转载请注明： 转载自Martin
<a href="http://www.blags.org/linux-find-command-daquan/">http://www.blags.org/linux-find-command-daquan/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T22:59:00.000Z"><a href="/2010/12/19/linux-word-order/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/linux-word-order/">Linux一句话命令</a></h1>
  

    </header>
    <div class="entry">
      
        <p>原文链接：<a href="http://bbs.linuxtone.org/thread-16-1-1.html">http://bbs.linuxtone.org/thread-16-1-1.html</a> IT运维专家网--&quot;自由平等，互助分享！&quot;
作者:NetSeek
原文加我的补充，以后会更加详细！</p>
<p>1.删除0字节文件</p>
<pre><code><figure class="highlight"><pre><span class="comment">find</span> <span class="literal">-</span><span class="comment">type</span> <span class="comment">f</span> <span class="literal">-</span><span class="comment">size</span> <span class="comment">0</span> <span class="literal">-</span><span class="comment">exec</span> <span class="comment">rm</span> <span class="literal">-</span><span class="comment">rf</span> <span class="comment">{}</span> <span class="comment">\;`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">2</span>.<span class="comment">查看进程</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`按内存从大到小排列</span>
<span class="comment">ps</span> <span class="literal">-</span><span class="comment">e</span> <span class="literal">-</span><span class="comment">o</span> <span class="comment">"%C</span> <span class="comment">:</span> <span class="comment">%p</span> <span class="comment">:</span> <span class="comment">%z</span> <span class="comment">:</span> <span class="comment">%a"|sort</span> <span class="literal">-</span><span class="comment">k5</span> <span class="literal">-</span><span class="comment">nr`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">3</span>.<span class="comment">按cpu利用率从大到小排列</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ps</span> <span class="literal">-</span><span class="comment">e</span> <span class="literal">-</span><span class="comment">o</span> <span class="comment">"%C</span> <span class="comment">:</span> <span class="comment">%p</span> <span class="comment">:</span> <span class="comment">%z</span> <span class="comment">:</span> <span class="comment">%a"|sort</span> <span class="literal">-</span><span class="comment">nr`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">4</span>.<span class="comment">打印说cache里的URL</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`grep</span> <span class="literal">-</span><span class="comment">r</span> <span class="literal">-</span><span class="comment">a</span> <span class="comment">jpg</span> <span class="comment">/data/cache/*</span> <span class="comment">|</span> <span class="comment">strings</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">"http:"</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="literal">-</span><span class="comment">F'http:'</span> <span class="comment">'{print</span> <span class="comment">"http:"$2;}'`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">5</span>.<span class="comment">查看http的并发请求数及其TCP连接状态：</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`netstat</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'/^tcp/</span> <span class="comment">{</span>+<span class="literal">+</span><span class="comment">S</span>[<span class="comment">$NF</span>]<span class="comment">}</span> <span class="comment">END</span> <span class="comment">{for(a</span> <span class="comment">in</span> <span class="comment">S)</span> <span class="comment">print</span> <span class="comment">a</span>, <span class="comment">S</span>[<span class="comment">a</span>]<span class="comment">}'`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">6</span>.&lt;<span class="comment">pre</span>&gt;<span class="comment">`</span> <span class="comment">sed</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">'/Root/s/no/yes/'</span> <span class="comment">/etc/ssh/sshd_config</span> <span class="comment">sed`</span>&lt;<span class="comment">/pre</span>&gt;
<span class="comment">在这个文里</span> <span class="comment">Root的一行，匹配Root一行，将no替换成yes</span>.

<span class="comment">7</span>.<span class="comment">1</span>.<span class="comment">如何杀掉mysql进程：</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ps</span> <span class="comment">aux|grep</span> <span class="comment">mysql|grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">grep|awk</span> <span class="comment">'{print</span> <span class="comment">$2}'|xargs</span> <span class="comment">kill</span> <span class="literal">-</span><span class="comment">9</span> <span class="comment">(从中了解到awk的用途)</span>
<span class="comment">pgrep</span> <span class="comment">mysql</span> <span class="comment">|xargs</span> <span class="comment">kill</span> <span class="literal">-</span><span class="comment">9</span> <span class="title">[</span><span class="comment">网友:&amp;FROST</span>]
<span class="comment">killall</span> <span class="literal">-</span><span class="comment">TERM</span> <span class="comment">mysqld</span>
<span class="comment">kill</span> <span class="literal">-</span><span class="comment">9</span> <span class="comment">`cat</span> <span class="comment">/usr/local/apache2/logs/httpd</span>.<span class="comment">pid`</span> <span class="comment">试试查杀进程PID`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">8</span>.<span class="comment">显示运行3级别开启的服务:</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ls</span> <span class="comment">/etc/rc3</span>.<span class="comment">d/S*</span> <span class="comment">|cut</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">15</span>- <span class="comment">(从中了解到cut的用途，截取数据)`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">9</span>.<span class="comment">如何在编写SHELL显示多个信息，用EOF</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`cat</span> &lt;&lt; <span class="comment">EOF</span>
<span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span>
<span class="comment">|</span> <span class="comment">===</span> <span class="comment">Welcome</span> <span class="comment">to</span> <span class="comment">Tunoff</span> <span class="comment">services</span> <span class="comment">===</span> <span class="comment">|</span>
<span class="literal">+</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">+</span>
<span class="comment">EOF`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">10\</span>. <span class="comment">for</span> <span class="comment">的巧用(如给mysql建软链接)</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`cd</span> <span class="comment">/usr/local/mysql/bin</span>
<span class="comment">for</span> <span class="comment">i</span> <span class="comment">in</span> <span class="comment">*</span>
<span class="comment">do</span> <span class="comment">ln</span> <span class="comment">/usr/local/mysql/bin/$i</span> <span class="comment">/usr/bin/$i</span>
<span class="comment">done`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">11\</span>. <span class="comment">取IP地址：</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ifconfig</span> <span class="comment">eth0|sed</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">'2p'|awk</span> <span class="comment">'{print</span> <span class="comment">$2}'|cut</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">6</span>-<span class="comment">30</span> <span class="comment">或者:</span>
<span class="comment">ifconfig</span> <span class="comment">eth0</span> <span class="comment">|grep</span> <span class="comment">"inet</span> <span class="comment">addr:"</span> <span class="comment">|awk</span> <span class="comment">'{print</span> <span class="comment">$2}'|cut</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">6</span>- <span class="comment">或者</span>
<span class="comment">ifconfig</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">'inet</span> <span class="comment">addr:'|</span> <span class="comment">grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">'127</span>.<span class="comment">0</span>.<span class="comment">0</span>.<span class="comment">1'</span> <span class="comment">|</span> <span class="comment">cut</span> <span class="literal">-</span><span class="comment">d:</span> <span class="literal">-</span><span class="comment">f2</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'{</span> <span class="comment">print</span> <span class="comment">$1}'</span>
<span class="comment">或者：</span>
<span class="comment">ifconfig</span> <span class="comment">eth0</span> <span class="comment">|</span> <span class="comment">sed</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">'/inet</span> <span class="comment">/{s/</span>.<span class="comment">*addr://;s/</span> <span class="string">.</span><span class="comment">*//;p}'`</span>&lt;<span class="comment">/pre</span>&gt;
<span class="comment">Perl实现获取IP的方法:</span>
<span class="comment">ifconfig</span> <span class="literal">-</span><span class="comment">a</span> <span class="comment">|</span> <span class="comment">perl</span> <span class="literal">-</span><span class="comment">ne</span> <span class="comment">'if</span> <span class="comment">(</span> <span class="comment">m/^\s*inet</span> <span class="comment">(?:addr:)?(</span>[<span class="comment">\d</span>.<span class="title">]</span><span class="literal">+</span><span class="comment">)</span>.<span class="comment">*?cast/</span> <span class="comment">)</span> <span class="comment">{</span> <span class="comment">print</span> <span class="comment">qq($1\n);</span> <span class="comment">exit</span> <span class="comment">0;</span> <span class="comment">}'</span>&lt;<span class="comment">/code</span>&gt;&lt;<span class="comment">/pre</span>&gt;

<span class="comment">12</span>.<span class="comment">内存的大小:</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`free</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">|grep</span> <span class="comment">"Mem"</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'{print</span> <span class="comment">$2}'`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">13</span>.
&lt;<span class="comment">pre</span>&gt;<span class="comment">`netstat</span> <span class="literal">-</span><span class="comment">an</span> <span class="literal">-</span><span class="comment">t</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">":80"</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">ESTABLISHED</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'{printf</span> <span class="comment">"%s</span> <span class="comment">%s\n"</span>,<span class="comment">$5</span>,<span class="comment">$6}'</span> <span class="comment">|</span> <span class="comment">sort`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">14</span>.<span class="comment">查看Apache的并发请求数及其TCP连接状态：</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`netstat</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'/^tcp/</span> <span class="comment">{</span>+<span class="literal">+</span><span class="comment">S</span>[<span class="comment">$NF</span>]<span class="comment">}</span> <span class="comment">END</span> <span class="comment">{for(a</span> <span class="comment">in</span> <span class="comment">S)</span> <span class="comment">print</span> <span class="comment">a</span>, <span class="comment">S</span>[<span class="comment">a</span>]<span class="comment">}'`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">15</span>.<span class="comment">因为同事要统计一下服务器下面所有的jpg的文件的大小</span>,<span class="comment">写了个shell给他来统计</span>.<span class="comment">原来用xargs实现</span>,<span class="comment">但他一次处理一部分</span>,<span class="comment">搞的有多个总和</span>.<span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">,</span><span class="comment">下面的命令就能解决啦</span>.
&lt;<span class="comment">pre</span>&gt;<span class="comment">`find</span> <span class="comment">/</span> <span class="literal">-</span><span class="comment">name</span> <span class="comment">*</span>.<span class="comment">jpg</span> <span class="literal">-</span><span class="comment">exec</span> <span class="comment">wc</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">{}</span> <span class="comment">\;|awk</span> <span class="comment">'{print</span> <span class="comment">$1}'|awk</span> <span class="comment">'{a</span>+<span class="comment">=$1}END{print</span> <span class="comment">a}'`</span>&lt;<span class="comment">/pre</span>&gt;
<span class="comment">CPU的数量（多核算多个CPU，cat</span> <span class="comment">/proc/cpuinfo</span> <span class="comment">|grep</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">processor）越多，系统负载越低，每秒能处理的请求数也越多。</span>
<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>

<span class="comment">16</span> <span class="comment">CPU负载</span> <span class="comment">#</span> <span class="comment">cat</span> <span class="comment">/proc/loadavg</span>
<span class="comment">检查前三个输出值是否超过了系统逻辑CPU的4倍。</span>

<span class="comment">18</span> <span class="comment">CPU负载</span> <span class="comment">#mpstat</span> <span class="comment">1</span> <span class="comment">1</span>
<span class="comment">检查%idle是否过低(比如小于5%)</span>

<span class="comment">19</span> <span class="comment">内存空间</span> <span class="comment">#</span> <span class="comment">free</span>
<span class="comment">检查free值是否过低</span> <span class="comment">也可以用</span> <span class="comment">#</span> <span class="comment">cat</span> <span class="comment">/proc/meminfo</span>

<span class="comment">20</span> <span class="comment">swap空间</span> <span class="comment">#</span> <span class="comment">free</span>
<span class="comment">检查swap</span> <span class="comment">used值是否过高</span> <span class="comment">如果swap</span> <span class="comment">used值过高，进一步检查swap动作是否频繁：</span>
<span class="comment">#</span> <span class="comment">vmstat</span> <span class="comment">1</span> <span class="comment">5</span>
<span class="comment">观察si和so值是否较大</span>

<span class="comment">21</span> <span class="comment">磁盘空间</span> <span class="comment">#</span> <span class="comment">df</span> <span class="literal">-</span><span class="comment">h</span>
<span class="comment">检查是否有分区使用率(Use%)过高(比如超过90%)</span> <span class="comment">如发现某个分区空间接近用尽，可以进入该分区的挂载点，用以下命令找出占用空间最多的文件或目录：</span>
<span class="comment">#</span> <span class="comment">du</span> <span class="literal">-</span><span class="comment">cks</span> <span class="comment">*</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="literal">-</span><span class="comment">rn</span> <span class="comment">|</span> <span class="comment">head</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">10</span>

<span class="comment">22</span> <span class="comment">磁盘I/O负载</span> <span class="comment">#</span> <span class="comment">iostat</span> <span class="literal">-</span><span class="comment">x</span> <span class="comment">1</span> <span class="comment">2</span>
<span class="comment">检查I/O使用率(%util)是否超过100%</span>

<span class="comment">23</span> <span class="comment">网络负载</span> <span class="comment">#</span> <span class="comment">sar</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">DEV</span>
<span class="comment">检查网络流量(rxbyt/s</span>, <span class="comment">txbyt/s)是否过高</span>

<span class="comment">24</span> <span class="comment">网络错误</span> <span class="comment">#</span> <span class="comment">netstat</span> <span class="literal">-</span><span class="comment">i</span>
<span class="comment">检查是否有网络错误(drop</span> <span class="comment">fifo</span> <span class="comment">colls</span> <span class="comment">carrier)</span> <span class="comment">也可以用命令：#</span> <span class="comment">cat</span> <span class="comment">/proc/net/dev</span>

<span class="comment">25</span> <span class="comment">网络连接数目</span>&lt;<span class="comment">pre</span>&gt;<span class="comment">`</span> <span class="comment">#</span> <span class="comment">netstat</span> <span class="literal">-</span><span class="comment">an</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="literal">-</span><span class="comment">E</span> <span class="comment">“^(tcp)”</span> <span class="comment">|</span> <span class="comment">cut</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">68</span>- <span class="comment">|</span> <span class="comment">sort</span> <span class="comment">|</span> <span class="comment">uniq</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="literal">-</span><span class="comment">n`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">26</span> <span class="comment">进程总数</span> <span class="comment">#</span> <span class="comment">ps</span> <span class="comment">aux</span> <span class="comment">|</span> <span class="comment">wc</span> <span class="literal">-</span><span class="comment">l</span>
<span class="comment">检查进程个数是否正常</span> <span class="comment">(比如超过250)</span>

<span class="comment">27</span> <span class="comment">可运行进程数目</span> <span class="comment">#</span> <span class="comment">vmwtat</span> <span class="comment">1</span> <span class="comment">5</span>
<span class="comment">列给出的是可运行进程的数目，检查其是否超过系统逻辑CPU的4倍</span>

<span class="comment">28</span> <span class="comment">进程</span> <span class="comment">#</span> <span class="comment">top</span> <span class="literal">-</span><span class="comment">id</span> <span class="comment">1</span>
<span class="comment">观察是否有异常进程出现</span>

<span class="comment">29</span> <span class="comment">网络状态</span> <span class="comment">检查DNS</span>, <span class="comment">网关等是否可以正常连通</span>

<span class="comment">30</span> <span class="comment">用户</span> <span class="comment">#</span> <span class="comment">who</span> <span class="comment">|</span> <span class="comment">wc</span> <span class="literal">-</span><span class="comment">l</span>
<span class="comment">检查登录用户是否过多</span> <span class="comment">(比如超过50个)</span> <span class="comment">也可以用命令：#</span> <span class="comment">uptime</span>

<span class="comment">31</span> <span class="comment">系统日志</span> <span class="comment">#</span> <span class="comment">cat</span> <span class="comment">/var/log/rflogview/*errors</span>
<span class="comment">检查是否有异常错误记录</span> <span class="comment">也可以搜寻一些异常关键字，例如：</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`#</span> <span class="comment">grep</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">error</span> <span class="comment">/var/log/messages</span>
<span class="comment">#</span> <span class="comment">grep</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">fail</span> <span class="comment">/var/log/messages</span>
<span class="comment">#</span> <span class="comment">egrep</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">'error|warn'</span> <span class="comment">/var/log/messages</span> <span class="comment">查看系统异常`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">32</span> <span class="comment">核心日志</span> <span class="comment">#</span> <span class="comment">dmesg</span>
<span class="comment">检查是否有异常错误记录</span>

<span class="comment">33</span> <span class="comment">系统时间</span> <span class="comment">#</span> <span class="comment">date</span>
<span class="comment">检查系统时间是否正确</span>

<span class="comment">34</span> <span class="comment">打开文件数目</span> <span class="comment">#</span> <span class="comment">lsof</span> <span class="comment">|</span> <span class="comment">wc</span> <span class="literal">-</span><span class="comment">l</span>
<span class="comment">检查打开文件总数是否过多</span>

<span class="comment">35</span> <span class="comment">日志</span> <span class="comment">#</span> <span class="comment">logwatch</span> <span class="comment">–print</span> <span class="comment">配置/etc/log</span>.<span class="comment">d/logwatch</span>.<span class="comment">conf，将</span> <span class="comment">Mailto</span> <span class="comment">设置为自己的email</span> <span class="comment">地址，启动mail服务</span> <span class="comment">(sendmail或者postfix)，这样就可以每天收到日志报告了。</span>
<span class="comment">缺省logwatch只报告昨天的日志，可以用#</span> <span class="comment">logwatch</span> <span class="comment">–print</span> <span class="comment">–range</span> <span class="comment">all</span> <span class="comment">获得所有的日志分析结果。</span>
<span class="comment">可以用#</span> <span class="comment">logwatch</span> <span class="comment">–print</span> <span class="comment">–detail</span> <span class="comment">high</span> <span class="comment">获得更具体的日志分析结果(而不仅仅是出错日志)。</span>

<span class="comment">36</span>.<span class="comment">杀掉80端口相关的进程</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`lsof</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">:80|grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">"PID"|awk</span> <span class="comment">'{print</span> <span class="comment">"kill</span> <span class="literal">-</span><span class="comment">9"</span>,<span class="comment">$2}'|sh`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">37</span>.<span class="comment">清除僵死进程。</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ps</span> <span class="literal">-</span><span class="comment">eal</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'{</span> <span class="comment">if</span> <span class="comment">($2</span> <span class="comment">==</span> <span class="comment">"Z")</span> <span class="comment">{print</span> <span class="comment">$4}}'</span> <span class="comment">|</span> <span class="comment">kill</span> <span class="literal">-</span><span class="comment">9`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">38</span>.<span class="comment">tcpdump</span> <span class="comment">抓包</span> <span class="comment">，用来防止80端口被人攻击时可以分析数据</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`#</span> <span class="comment">tcpdump</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">10000</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">eth0</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">dst</span> <span class="comment">port</span> <span class="comment">80</span> &gt; <span class="comment">/root/pkts`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">39</span>.<span class="comment">然后检查IP的重复数</span> <span class="comment">并从小到大排序</span> <span class="comment">注意</span> <span class="comment">"</span>-<span class="comment">t\</span> <span class="literal">+</span><span class="comment">0"</span> <span class="comment">中间是两个空格</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`#</span> <span class="comment">less</span> <span class="comment">pkts</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">{'printf</span> <span class="comment">$3"\n"'}</span> <span class="comment">|</span> <span class="comment">cut</span> <span class="literal">-</span><span class="comment">d</span>. <span class="literal">-</span><span class="comment">f</span> <span class="comment">1</span>-<span class="comment">4</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="comment">|</span> <span class="comment">uniq</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">{'printf</span> <span class="comment">$1"</span> <span class="comment">"$2"\n"'}</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="literal">-</span><span class="comment">n</span> <span class="literal">-</span><span class="comment">t\</span> <span class="literal">+</span><span class="comment">0`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">40</span>.<span class="comment">查看有多少个活动的php</span>-<span class="comment">cgi进程</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`netstat</span> <span class="literal">-</span><span class="comment">anp</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">php</span>-<span class="comment">cgi</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">^tcp</span> <span class="comment">|</span> <span class="comment">wc</span> <span class="literal">-</span><span class="comment">l`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">41</span>.<span class="comment">利用iptables对应简单攻击</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`netstat</span> <span class="literal">-</span><span class="comment">an</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">LISTEN</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">‘{print</span> <span class="comment">$5}’</span> <span class="comment">|grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">127</span>.<span class="comment">0</span>.<span class="comment">0</span>.<span class="comment">1|grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">本机ip|sed</span> <span class="comment">“s/::ffff://g”|awk</span> <span class="comment">‘BEGIN</span> <span class="comment">{</span> <span class="comment">FS=”:”</span> <span class="comment">}</span> <span class="comment">{</span> <span class="comment">Num</span>[<span class="comment">$1</span>]<span class="literal">+</span><span class="literal">+</span> <span class="comment">}</span> <span class="comment">END</span> <span class="comment">{</span> <span class="comment">for(i</span> <span class="comment">in</span> <span class="comment">Num)</span> <span class="comment">if(Num</span>&gt;<span class="comment">8)</span> <span class="comment">{</span> <span class="comment">print</span> <span class="comment">i}</span> <span class="comment">}’</span> <span class="comment">|grep</span> <span class="comment">‘</span>[<span class="comment">0</span>-<span class="comment">9</span>]<span class="comment">\{1</span>,<span class="comment">3\}\</span>.<span class="title">[</span><span class="comment">0</span>-<span class="comment">9</span>]<span class="comment">\{1</span>,<span class="comment">3\}\</span>.<span class="title">[</span><span class="comment">0</span>-<span class="comment">9</span>]<span class="comment">\{1</span>,<span class="comment">3\}\</span>.<span class="title">[</span><span class="comment">0</span>-<span class="comment">9</span>]<span class="comment">\{1</span>,<span class="comment">3\}’|</span> <span class="comment">xargs</span> <span class="literal">-</span><span class="comment">i</span>[<span class="title">]</span> <span class="comment">iptables</span> <span class="literal">-</span><span class="comment">I</span> <span class="comment">INPUT</span> <span class="literal">-</span><span class="comment">s</span> <span class="title">[</span><span class="title">]</span> <span class="literal">-</span><span class="comment">j</span> <span class="comment">DROP`</span>&lt;<span class="comment">/pre</span>&gt;
<span class="comment">Num</span>&gt;<span class="comment">8部分设定值为阀值，这条句子会自动将netstat</span> <span class="literal">-</span><span class="comment">an</span> <span class="comment">中查到的来自同一ＩＰ的超过一定量的连接的列入禁止范围。</span> <span class="comment">基中本机ip改成你的服务器的ip地址</span>

<span class="comment">42\</span>. <span class="comment">怎样知道某个进程在哪个CPU上运行？</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`#</span> <span class="comment">ps</span> <span class="literal">-</span><span class="comment">eo</span> <span class="comment">pid</span>,<span class="comment">args</span>,<span class="comment">psr`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">43\</span>. <span class="comment">查看硬件制造商</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`dmidecode</span> <span class="literal">-</span><span class="comment">s</span> <span class="comment">system</span>-<span class="comment">product</span>-<span class="comment">name`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">44</span>.<span class="comment">perl如何编译成字节码，这样在处理复杂项目的时候会更快一点？</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`perlcc</span> <span class="literal">-</span><span class="comment">B</span> <span class="literal">-</span><span class="comment">o</span> <span class="comment">webseek</span> <span class="comment">webseek</span>.<span class="comment">pl`</span>&lt;<span class="comment">/pre</span>&gt;
<span class="comment">###补充</span>
<span class="comment">在当前目录及子目录下搜索所有后缀为</span> <span class="string">.</span><span class="comment">php</span> <span class="comment">的文件，并且将</span> <span class="comment">字符串</span> <span class="comment">baidu</span>.<span class="comment">com</span> <span class="comment">替换成</span> <span class="comment">opendoc</span>.<span class="comment">com</span>.<span class="comment">cn</span>
<span class="comment">find</span> <span class="literal">-</span><span class="comment">name</span> <span class="comment">*</span>.<span class="comment">php</span> <span class="comment">|xargs</span> <span class="comment">perl</span> <span class="literal">-</span><span class="comment">pi</span> <span class="literal">-</span><span class="comment">e</span> <span class="comment">'s|baidu</span>.<span class="comment">com|opendoc</span>.<span class="comment">com</span>.<span class="comment">cn|g';</span>
<span class="comment">sed</span> <span class="literal">-</span><span class="comment">i</span> <span class="comment">"s/baidu</span>.<span class="comment">com/opendoc</span>.<span class="comment">com</span>.<span class="comment">cn/g"</span> <span class="comment">`grep</span> <span class="comment">baidu</span>.<span class="comment">com</span> <span class="literal">-</span><span class="comment">rl</span> <span class="string">.</span><span class="comment">/`</span>&lt;<span class="comment">/code</span>&gt;&lt;<span class="comment">/pre</span>&gt;

<span class="comment">vim</span> <span class="comment">颜色</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`if</span> <span class="title">[</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">"$BASH_VERSION"</span> <span class="literal">-</span><span class="comment">o</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">"$KSH_VERSION"</span> <span class="literal">-</span><span class="comment">o</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">"$ZSH_VERSION"</span> <span class="title">]</span><span class="comment">;</span> <span class="comment">then</span>
<span class="title">[</span> <span class="literal">-</span><span class="comment">x</span> <span class="comment">/usr/bin/id</span> <span class="title">]</span> <span class="comment">||</span> <span class="comment">return</span>
<span class="comment">alias</span> <span class="comment">vi</span> &gt;<span class="comment">/dev/null</span> <span class="comment">2</span>&gt;<span class="comment">&amp;1</span> <span class="comment">||</span> <span class="comment">alias</span> <span class="comment">vi=vim</span>
<span class="comment">fi`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">1</span>.<span class="comment">按内存从大到小排列进程:</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ps</span> <span class="literal">-</span><span class="comment">eo</span> <span class="comment">"%C</span> <span class="comment">:</span> <span class="comment">%p</span> <span class="comment">:</span> <span class="comment">%z</span> <span class="comment">:</span> <span class="comment">%a"|sort</span> <span class="literal">-</span><span class="comment">k5</span> <span class="literal">-</span><span class="comment">nr`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">2</span>.<span class="comment">查看当前有哪些进程；查看进程打开的文件:</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ps</span> <span class="literal">-</span><span class="comment">A</span> <span class="comment">；lsof</span> <span class="literal">-</span><span class="comment">p</span> <span class="comment">PID`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">3</span>.<span class="comment">获取当前IP地址（从中学习grep</span>,<span class="comment">awk</span>,<span class="comment">cut的作用）</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ifconfig</span> <span class="comment">eth0</span> <span class="comment">|grep</span> <span class="comment">"inet</span> <span class="comment">addr:"</span> <span class="comment">|awk</span> <span class="comment">'{print</span> <span class="comment">$2}'|cut</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">6</span>-<span class="comment">`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">4</span>.<span class="comment">统计每个单词出现的频率，并排序</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`awk</span> <span class="comment">'{arr</span>[<span class="comment">$1</span>]<span class="literal">+</span><span class="comment">=1</span> <span class="comment">}END{for(i</span> <span class="comment">in</span> <span class="comment">arr){print</span> <span class="comment">arr"\t"i}}'</span> <span class="comment">文件名</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="literal">-</span><span class="comment">rn`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">5</span>.<span class="comment">显示10条最常用的命令</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`sed</span> <span class="literal">-</span><span class="comment">e</span> <span class="comment">"s/|</span> <span class="comment">/\n/g"</span> <span class="comment">~/</span>.<span class="comment">bash_history</span> <span class="comment">|</span> <span class="comment">cut</span> <span class="literal">-</span><span class="comment">d</span> <span class="comment">'</span> <span class="comment">'</span> <span class="literal">-</span><span class="comment">f</span> <span class="comment">1</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="comment">|</span> <span class="comment">uniq</span> <span class="literal">-</span><span class="comment">c</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="literal">-</span><span class="comment">nr</span> <span class="comment">|</span> <span class="comment">head`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">6</span>.<span class="comment">杀死Nginx进程(杀死某一进程)</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`ps</span> <span class="literal">-</span><span class="comment">ef|grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">grep</span> <span class="comment">|grep</span> <span class="comment">nginx|awk</span> <span class="comment">'{print</span> <span class="comment">$2}'</span> <span class="comment">或</span>
<span class="comment">for</span> <span class="comment">i</span> <span class="comment">in</span> <span class="comment">`ps</span> <span class="comment">aux</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="comment">nginx</span> <span class="comment">|</span> <span class="comment">grep</span> <span class="literal">-</span><span class="comment">v</span> <span class="comment">grep</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">{'print</span> <span class="comment">$2'}`</span> <span class="comment">;</span> <span class="comment">do</span> <span class="comment">kill</span> <span class="comment">$i;</span> <span class="comment">done`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">7</span>.<span class="comment">列出当前文件夹目录大小，以G，M，K显示。</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`du</span> <span class="literal">-</span><span class="comment">b</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">max</span>-<span class="comment">depth</span> <span class="comment">1</span> <span class="comment">|</span> <span class="comment">sort</span> <span class="literal">-</span><span class="comment">nr</span> <span class="comment">|</span> <span class="comment">perl</span> <span class="literal">-</span><span class="comment">pe</span> <span class="comment">'s{(</span>[<span class="comment">0</span>-<span class="comment">9</span>]<span class="literal">+</span><span class="comment">)}{sprintf"%</span>.<span class="comment">1f%s"</span>, <span class="comment">$1</span>&gt;<span class="comment">=2**30?</span> <span class="comment">($1/2**30</span>, <span class="comment">"G"):</span> <span class="comment">$1</span>&gt;<span class="comment">=2**20?</span> <span class="comment">($1/2**20</span>, <span class="comment">"M"):$1</span>&gt;<span class="comment">=2**10?</span> <span class="comment">($1/2**10</span>, <span class="comment">"K"):</span> <span class="comment">($1</span>, <span class="comment">"")}e'</span>
<span class="comment">shaw答案</span> <span class="comment">：du</span> <span class="literal">-</span><span class="comment">hs</span> <span class="comment">$(du</span> <span class="literal">-</span><span class="comment">sk</span> <span class="string">.</span><span class="comment">/`ls</span> <span class="literal">-</span><span class="comment">F</span> <span class="comment">|grep</span> <span class="comment">/`</span> <span class="comment">|sort</span> <span class="literal">-</span><span class="comment">nr</span> <span class="comment">|awk</span> <span class="comment">'{print</span> <span class="comment">$NF}')</span>
<span class="comment">也可</span> <span class="comment">以实现，不过不是特别完美。但好记。`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">8</span>.<span class="comment">清空linux</span> <span class="comment">buffer</span> <span class="comment">cache</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`sync</span> <span class="comment">&amp;&amp;</span> <span class="comment">echo</span> <span class="comment">3</span> &gt; <span class="comment">/proc/sys/vm/drop_caches`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">9</span>.<span class="comment">将当前目录文件名全部转换成小写</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`for</span> <span class="comment">i</span> <span class="comment">in</span> <span class="comment">*;</span> <span class="comment">do</span> <span class="comment">mv</span> <span class="comment">"$i"</span> <span class="comment">"$(echo</span> <span class="comment">$i|tr</span> <span class="comment">A</span>-<span class="comment">Z</span> <span class="comment">a</span>-<span class="comment">z)";</span> <span class="comment">done`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">10</span>.<span class="comment">消除vim中的^M的几种方法</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`1)dos2uninx</span> <span class="comment">filename</span>
<span class="comment">2)sed</span> <span class="literal">-</span><span class="comment">e</span> <span class="comment">'s/^M//'</span> <span class="comment">filename</span>
<span class="comment">3)vim中</span> <span class="comment">:s/^M//gc</span>
<span class="comment">4)col</span> <span class="literal">-</span><span class="comment">bx</span> &lt; <span class="comment">dosfile</span> &gt; <span class="comment">newfile</span>
<span class="comment">5)tr</span> <span class="literal">-</span><span class="comment">s</span> <span class="comment">"\r\n"</span> <span class="comment">"\n"</span> &lt; <span class="comment">file</span> &gt; <span class="comment">newfile`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">11\</span>. <span class="comment">清除所有arp缓存</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`arp</span> <span class="literal">-</span><span class="comment">n|awk</span> <span class="comment">'/^</span>[<span class="comment">1</span>-<span class="comment">9</span>]<span class="comment">/</span> <span class="comment">{print</span> <span class="comment">"arp</span> <span class="literal">-</span><span class="comment">d</span> <span class="comment">"$1}'|sh`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">12\</span>. <span class="comment">绑定已知机器的arp地址</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`cat</span> <span class="comment">/proc/net/arp</span> <span class="comment">|</span> <span class="comment">awk</span> <span class="comment">'{print</span> <span class="comment">$1</span> <span class="comment">"</span> <span class="comment">"</span> <span class="comment">$4}'</span> <span class="comment">|sort</span> <span class="literal">-</span><span class="comment">t</span>. <span class="literal">-</span><span class="comment">n</span> <span class="literal">+</span><span class="comment">3</span> <span class="literal">-</span><span class="comment">4</span> &gt; <span class="comment">/etc/ethers`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">13\</span>. &lt;<span class="comment">pre</span>&gt;<span class="comment">`perl</span> <span class="literal">-</span><span class="comment">ne</span> <span class="comment">'m/^(</span>[<span class="comment">^#</span>]<span class="title">[</span><span class="comment">^\s=</span>]<span class="literal">+</span><span class="comment">)\s*(=</span>.<span class="comment">*|)/</span> <span class="comment">&amp;&amp;</span> <span class="comment">printf("%</span>-<span class="comment">35s%s\n"</span>, <span class="comment">$1</span>, <span class="comment">$2)'</span> <span class="comment">/etc/my</span>.<span class="comment">cnf
</pre></figure></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T22:50:14.000Z"><a href="/2010/12/19/linux-allcommands-1/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/linux-allcommands-1/">linux系统管理技巧(一)</a></h1>
  

    </header>
    <div class="entry">
      
        <p>本文来自： allcommands
整理其比较实用的好的程序，并翻译过来。</p>
<p>一、在当前目录及子目录下搜索所有后缀为 .php 的文件，并且将 字符串 baidu.com 替换成 opendoc.com.cn</p>
<pre><code><figure class="highlight"><pre>find -name *.php |xargs perl -pi -e <span class="string">'s|baidu.com|opendoc.com.cn|g'</span>;
sed -i <span class="string">"s/baidu.com/opendoc.com.cn/g"</span> `grep baidu.com -rl ./``&lt;/pre&gt;

二、将当前目录文件名全部转换成小写
&lt;pre&gt;`<span class="keyword">for</span> i <span class="keyword">in</span> *; <span class="keyword">do</span> mv <span class="string">"$i"</span> <span class="string">"$(echo $i|tr A-Z a-z)"</span>; done`&lt;/pre&gt;

三、查找二个文件相同的内容
&lt;pre&gt;`grep -Fx -f file1 file2
sort file1 file2 | uniq -d`&lt;/pre&gt;

四、查找file2里 file1里没有的内容
&lt;pre&gt;`grep -Fxv -f file1 file2`&lt;/pre&gt;

五、自动更新SVN的一个目录
&lt;pre&gt;`<span class="keyword">for</span> d <span class="keyword">in</span> $(find . -maxdepth <span class="number">1</span> -<span class="built_in">type</span> d -name <span class="string">'[^.]*'</span>); <span class="keyword">do</span> cd <span class="string">"$d"</span>; svn up; cd ..; done`&lt;/pre&gt;

六、查找当前文件列表 文件与组没有修改时间排序
&lt;pre&gt;`find . -<span class="built_in">type</span> f | xargs ls -ltrhg
l: 所有信息
t: 修改时间排序
r: 倒序
h: 大小 M K
g: 用户组`&lt;/pre&gt;

七、找到文件，将其与一个可读的信息输出列表
&lt;pre&gt;`find . -<span class="built_in">type</span> f | sed <span class="string">'s,.*,stat "&amp;" | egrep "File|Modify" | tr "\\n" " " ; echo ,'</span> | sh | sed <span class="string">'s,[^/]*/\(.*\). Modify: \(....-..-.. ..:..:..\).*,\2 \1,'</span> | sort
find . -<span class="built_in">type</span> f -exec ls -tr {} +
find . -<span class="built_in">type</span> f | sed <span class="string">'s,.*,stat "&amp;" | egrep "File|Modify" | tr "\\n" " " ; echo ,'</span> | sh | sed <span class="string">'s,[^/]*/\(.*\). Modify: \(...........\).*,\2 \1,'</span> | sort
ls -rl <span class="comment">--time-style=+%s * | sed '/^$/,/^total [0-9]*$/d' | sort -nk6`&lt;/pre&gt;</span>

八、查找文件和他们按修改时间排序的列表
&lt;pre&gt;`ls -rl <span class="comment">--time-style=+%s * | sed '/^$/,/^total [0-9]*$/d' | sort -nk6`&lt;/pre&gt;</span>

九、查找N天前的文件，按时间排序
&lt;pre&gt;`find . -<span class="built_in">type</span> f -mtime -<span class="number">14</span> -exec ls -ltd \{\} \; | less`&lt;/pre&gt;

十、配置PS aliases
&lt;pre&gt;`export PSOA=<span class="string">'user,pid,time,state,command'</span> ; <span class="function"><span class="keyword">function</span> <span class="title">_ps</span> { /<span class="title">bin</span>/<span class="title">ps</span> $@ ; } ; <span class="title">alias</span> <span class="title">psa</span>='<span class="title">_ps</span> <span class="title">ax</span> -<span class="title">o</span>
$<span class="title">PSOA</span>'
#<span class="title">ps</span> <span class="title">aliases</span>
<span class="title">PSO</span>='<span class="title">user</span>,<span class="title">pid</span>,<span class="title">ppid</span>,%<span class="title">cpu</span>,%<span class="title">mem</span>,<span class="title">time</span>,<span class="title">start</span>,<span class="title">state</span>,<span class="title">command</span>'
<span class="title">PSOA</span>='<span class="title">user</span>,<span class="title">pid</span>,<span class="title">time</span>,<span class="title">state</span>,<span class="title">command</span>'
<span class="title">PSOL</span>='<span class="title">user</span>,<span class="title">pid</span>,<span class="title">ppid</span>,%<span class="title">cpu</span>,%<span class="title">mem</span>,<span class="title">nice</span>,<span class="title">pri</span>,<span class="title">etime</span>,<span class="title">time</span>,<span class="title">tt</span>,<span class="title">state</span>,<span class="title">ucomm</span>'
<span class="title">export</span> <span class="title">PSO</span> <span class="title">PSOA</span> <span class="title">PSOL</span>
<span class="title">function</span> <span class="title">_ps</span> { /<span class="title">bin</span>/<span class="title">ps</span> $@ ; }
<span class="title">alias</span> <span class="title">ps</span>='<span class="title">_ps</span> <span class="title">ax</span> -<span class="title">o</span> $<span class="title">PSO</span>'
<span class="title">alias</span> <span class="title">psa</span>='<span class="title">_ps</span> <span class="title">ax</span> -<span class="title">o</span> $<span class="title">PSOA</span>'
<span class="title">alias</span> <span class="title">psl</span>='<span class="title">_ps</span> <span class="title">ax</span> -<span class="title">o</span> $<span class="title">PSOL</span>'
<span class="title">alias</span> <span class="title">psm</span>='<span class="title">_ps</span> -<span class="title">U</span> $<span class="title">USER</span> -<span class="title">o</span> $<span class="title">PSOA</span>'
`&lt;/<span class="title">pre</span>&gt;

十一、逐渐打印各行
&lt;<span class="title">pre</span>&gt;`<span class="title">awk</span> '<span class="title">BEGIN</span>{<span class="title">ORS</span>=""}<span class="title">NR</span>!=1&amp;&amp;<span class="title">FNR</span>==1{<span class="title">print</span> "\<span class="title">n</span>"}{<span class="title">print</span>}<span class="title">END</span>{<span class="title">print</span> "\<span class="title">n</span>"}' *.<span class="title">txt</span>
</pre></figure></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T22:47:22.000Z"><a href="/2010/12/19/linux-system-user-commands/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/linux-system-user-commands/">linux系统管理员常用命令集合</a></h1>
  

    </header>
    <div class="entry">
      
        <p>本文由linuxtone.org Netseek出品
一些命令我用着不是很习惯。对系统，日志等命令进行了补充</p>
<p><strong>系统连接状态篇：</strong></p>
<p>1.查看TCP连接状态</p>
<pre><code><figure class="highlight"><pre><span class="xml">netstat -nat |awk '{print </span><span class="variable">$6}</span><span class="xml">'|sort|uniq -c|sort -rn
netstat -n | awk '/</span><span class="keyword">^tcp</span><span class="xml">/ {++S[</span><span class="variable">$NF</span><span class="xml">]};END {for(a in S) print a, S[a]}'
netstat -n | awk '/</span><span class="keyword">^tcp</span><span class="xml">/ {++state[</span><span class="variable">$NF</span><span class="xml">]}; END {for(key in state) print key,"\t",state[key]}'
netstat -n | awk '/</span><span class="keyword">^tcp</span><span class="xml">/ {++arr[</span><span class="variable">$NF</span><span class="xml">]};END {for(k in arr) print k,"\t",arr[k]}'
netstat -n |awk '/</span><span class="keyword">^tcp</span><span class="xml">/ {print </span><span class="variable">$NF}</span><span class="xml">'|sort|uniq -c|sort -rn
netstat -ant | awk '{print </span><span class="variable">$NF}</span><span class="xml">' | grep -v '[a-z]' | sort | uniq -c
netstat -ant|awk '/ip:</span><span class="number">80</span><span class="xml">/{split(</span><span class="variable">$5</span><span class="xml">,ip,":");++S[ip[</span><span class="number">1</span><span class="xml">]]}END{for (a in S) print S[a],a}' |sort -n
netstat -ant|awk '/:</span><span class="number">80</span><span class="xml">/{split(</span><span class="variable">$5</span><span class="xml">,ip,":");++S[ip[</span><span class="number">1</span><span class="xml">]]}END{for (a in S) print S[a],a}' |sort -rn|head -n </span><span class="number">10</span><span class="xml">
awk 'BEGIN{printf ("http_code\tcount_num\n")}{COUNT[</span><span class="variable">$10</span><span class="xml">]++}END{for (a in COUNT) printf a"\t\t"COUNT[a]"\n"}'
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">2.</span><span class="xml">查找请求数请</span><span class="number">20</span><span class="xml">个IP（常用于查找攻来源）：
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`netstat -anlp|grep </span><span class="number">80</span><span class="xml">|grep tcp|awk '{print </span><span class="variable">$5}</span><span class="xml">'|awk -F: '{print </span><span class="variable">$1}</span><span class="xml">'|sort|uniq -c|sort -nr|head -n20
netstat -ant |awk '/:</span><span class="number">80</span><span class="xml">/{split(</span><span class="variable">$5</span><span class="xml">,ip,":");++A[ip[</span><span class="number">1</span><span class="xml">]]}END{for(i in A) print A[i],i}' |sort -rn|head -n20
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">3.</span><span class="xml">用tcpdump嗅探</span><span class="number">80</span><span class="xml">端口的访问看看谁最高
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`tcpdump -i eth0 -tnn dst port </span><span class="number">80</span><span class="xml"> -c </span><span class="number">1000</span><span class="xml"> | awk -F"." '{print </span><span class="variable">$1</span><span class="xml">"."</span><span class="variable">$2</span><span class="xml">"."</span><span class="variable">$3</span><span class="xml">"."</span><span class="variable">$4}</span><span class="xml">' | sort | uniq -c | sort -nr |head -</span><span class="number">20</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">4.</span><span class="xml">查找较多time_wait连接
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`netstat -n|grep TIME_WAIT|awk '{print </span><span class="variable">$5}</span><span class="xml">'|sort|uniq -c|sort -rn|head -n20
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">5.</span><span class="xml">找查较多的SYN连接
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`netstat -an | grep SYN | awk '{print </span><span class="variable">$5}</span><span class="xml">' | awk -F: '{print </span><span class="variable">$1}</span><span class="xml">' | sort | uniq -c | sort -nr | more
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">6.</span><span class="xml">根据端口列进程
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`netstat -ntlp | grep </span><span class="number">80</span><span class="xml"> | awk '{print </span><span class="variable">$7}</span><span class="xml">' | cut -d/ -f1
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

**网站日志分析篇</span><span class="number">1</span><span class="xml">（Apache）**：
</span><span class="number">1.</span><span class="xml">获得访问前</span><span class="number">10</span><span class="xml">位的ip地址
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log|awk '{print </span><span class="variable">$1}</span><span class="xml">'|sort|uniq -c|sort -nr|head -</span><span class="number">10</span><span class="xml">
cat access.log|awk '{counts[$(</span><span class="number">11</span><span class="xml">)]+=</span><span class="number">1</span><span class="xml">}; END {for(url in counts) print counts[url], url}'
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">2.</span><span class="xml">访问次数最多的文件或页面,取前</span><span class="number">20</span><span class="xml">
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log|awk '{print </span><span class="variable">$11}</span><span class="xml">'|sort|uniq -c|sort -nr|head -</span><span class="number">20</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">3.</span><span class="xml">列出传输最大的几个exe文件（分析下载站的时候常用）
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '(</span><span class="variable">$7</span><span class="xml">~/\.exe/){print </span><span class="variable">$10</span><span class="xml"> " " </span><span class="variable">$1</span><span class="xml"> " " </span><span class="variable">$4</span><span class="xml"> " " </span><span class="variable">$7}</span><span class="xml">'|sort -nr|head -</span><span class="number">20</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">4.</span><span class="xml">列出输出大于</span><span class="number">200000</span><span class="xml">byte(约</span><span class="number">200</span><span class="xml">kb)的exe文件以及对应文件发生次数
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '(</span><span class="variable">$10</span><span class="xml"> &gt; </span><span class="number">200000</span><span class="xml"> &amp;&amp; </span><span class="variable">$7</span><span class="xml">~/\.exe/){print </span><span class="variable">$7}</span><span class="xml">'|sort -n|uniq -c|sort -nr|head -</span><span class="number">100</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">5.</span><span class="xml">如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '(</span><span class="variable">$7</span><span class="xml">~/\.php/){print </span><span class="variable">$NF</span><span class="xml"> " " </span><span class="variable">$1</span><span class="xml"> " " </span><span class="variable">$4</span><span class="xml"> " " </span><span class="variable">$7}</span><span class="xml">'|sort -nr|head -</span><span class="number">100</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">6.</span><span class="xml">列出最最耗时的页面(超过</span><span class="number">60</span><span class="xml">秒的)的以及对应页面发生次数
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '(</span><span class="variable">$NF</span><span class="xml"> &gt; </span><span class="number">60</span><span class="xml"> &amp;&amp; </span><span class="variable">$7</span><span class="xml">~/\.php/){print </span><span class="variable">$7}</span><span class="xml">'|sort -n|uniq -c|sort -nr|head -</span><span class="number">100</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">7.</span><span class="xml">列出传输时间超过 </span><span class="number">30</span><span class="xml"> 秒的文件
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '(</span><span class="variable">$NF</span><span class="xml"> &gt; </span><span class="number">30</span><span class="xml">){print </span><span class="variable">$7}</span><span class="xml">'|sort -n|uniq -c|sort -nr|head -</span><span class="number">20</span><span class="xml">
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">8.</span><span class="xml">统计网站流量（G)
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '{sum+=</span><span class="variable">$10}</span><span class="xml"> END {print sum/</span><span class="number">1024</span><span class="xml">/</span><span class="number">1024</span><span class="xml">/</span><span class="number">1024</span><span class="xml">}'
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">9.</span><span class="xml">统计</span><span class="number">404</span><span class="xml">的连接
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`awk '(</span><span class="variable">$9</span><span class="xml"> ~/</span><span class="number">404</span><span class="xml">/)' access.log | awk '{print </span><span class="variable">$9</span><span class="xml">,</span><span class="variable">$7}</span><span class="xml">' | sort
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">10</span><span class="xml">\. 统计http status.
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '{counts[$(</span><span class="number">9</span><span class="xml">)]+=</span><span class="number">1</span><span class="xml">}; END {for(code in counts) print code, counts[code]}'
cat access.log |awk '{print </span><span class="variable">$9}</span><span class="xml">'|sort|uniq -c|sort -rn
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">11.</span><span class="xml">每秒并发：
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`awk '{if(</span><span class="variable">$9</span><span class="xml">~/</span><span class="number">200</span><span class="xml">|</span><span class="number">30</span><span class="xml">|</span><span class="number">404</span><span class="xml">/)COUNT[</span><span class="variable">$4</span><span class="xml">]++}END{for( a in COUNT) print a,COUNT[a]}'|sort -k </span><span class="number">2</span><span class="xml"> -nr|head -n10
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">12.</span><span class="xml">带宽统计
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat apache.log |awk '{if(</span><span class="variable">$7</span><span class="xml">~/GET/) count++}END{print "client_request="count}'
cat apache.log |awk '{BYTE+=</span><span class="variable">$11}</span><span class="xml">END{print "client_kbyte_out="BYTE/</span><span class="number">1024</span><span class="xml">"KB"}'
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">13.</span><span class="xml">统计对象数量及对象平均大小
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`cat access.log |awk '{byte+=</span><span class="variable">$10}</span><span class="xml">END{ print byte/NR/</span><span class="number">1024</span><span class="xml">,NR}'
cat access.log |awk '{if(</span><span class="variable">$9</span><span class="xml">~/</span><span class="number">200</span><span class="xml">|</span><span class="number">30</span><span class="xml">/)COUNT[</span><span class="variable">$NF</span><span class="xml">]++}END{for( a in COUNT) print a,COUNT
[a],NR,COUNT[a]/NR*</span><span class="number">100</span><span class="xml">"%"}
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">14.</span><span class="xml">取</span><span class="number">5</span><span class="xml">分钟日志
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`if [ </span><span class="variable">$DATE_MINUTE</span><span class="xml"> != </span><span class="variable">$DATE_END_MINUTE</span><span class="xml"> ] ;then #则判断开始时间戳与结束时间戳是否相等
START_LINE=`sed -n "/</span><span class="variable">$DATE_MINUTE</span><span class="xml">/=" </span><span class="variable">$APACHE_LOG</span><span class="xml">|head -n1` #如果不相等，则取出开始时间戳的行号，与结束时间戳的行号
</span><span class="comment">#END_LINE=`sed -n "/$DATE_END_MINUTE/=" $APACHE_LOG|tail -n1`</span><span class="xml">
END_LINE=`sed -n "/</span><span class="variable">$DATE_END_MINUTE</span><span class="xml">/=" </span><span class="variable">$APACHE_LOG</span><span class="xml">|head -n1`
sed -n "</span><span class="variable">${START_LINE}</span><span class="xml">,</span><span class="variable">${END_LINE}</span><span class="xml">p" </span><span class="variable">$APACHE_LOG</span><span class="xml"> &gt; </span><span class="variable">$MINUTE_LOG</span><span class="xml"> ##通过行号，取出</span><span class="number">5</span><span class="xml">分钟内的日志内容 存放到 临时文件中
GET_START_TIME=`sed -n "</span><span class="variable">${START_LINE}</span><span class="xml">p" </span><span class="variable">$APACHE_LOG</span><span class="xml">|awk -F '[' '{print </span><span class="variable">$2}</span><span class="xml">' |awk '{print </span><span class="variable">$1}</span><span class="xml">'|
sed 's#/# #g'|sed 's#:# #'` #通过行号获取取出开始时间戳
GET_END_TIME=`sed -n "</span><span class="variable">${END_LINE}</span><span class="xml">p" </span><span class="variable">$APACHE_LOG</span><span class="xml">|awk -F '[' '{print </span><span class="variable">$2}</span><span class="xml">' |awk '{print </span><span class="variable">$1}</span><span class="xml">'|sed
's#/# #g'|sed 's#:# #'` #通过行号获取结束时间戳
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

</span><span class="number">10.</span><span class="xml">蜘蛛分析
查看是哪些蜘蛛在抓取内容。
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`/usr/sbin/tcpdump -i eth0 -l -s </span><span class="number">0</span><span class="xml"> -w - dst port </span><span class="number">80</span><span class="xml"> | strings | grep -i user-agent | grep -i -E 'bot|crawler|slurp|spider'
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

**网站日分析</span><span class="number">2</span><span class="xml">(Squid篇）**
</span><span class="number">2.</span><span class="xml">按域统计流量
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`zcat squid_access.log.tar.gz| awk '{print </span><span class="variable">$10</span><span class="xml">,</span><span class="variable">$7}</span><span class="xml">' |awk 'BEGIN{FS="[ /]"}{trfc[</span><span class="variable">$4</span><span class="xml">]+=</span><span class="variable">$1}</span><span class="xml">END{for
(domain in trfc){printf "%s\t%d\n",domain,trfc[domain]}}'
效率更高的perl版本请到此下载:http://docs.linuxtone.org/soft/tools/tr.pl
`<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

**数据库篇**
</span><span class="number">1.</span><span class="xml">查看数据库执行的sql
<span class="tag">&lt;<span class="title">pre</span>&gt;</span>`/usr/sbin/tcpdump -i eth0 -s </span><span class="number">0</span><span class="xml"> -l -w - dst port </span><span class="number">3306</span><span class="xml"> | strings | egrep -i 'SELECT|UPDATE|DELETE|INSERT|SET|COMMIT|ROLLBACK|CREATE|DROP|ALTER|CALL'</span>
</pre></figure></code></pre>
<p><strong>系统Debug分析篇</strong>
1.调试命令
strace -p pid
2.跟踪指定进程的PID
gdb -p pid
更多的请参考：
<a href="http://bbs.linuxtone.org/forum-14-1.html">http://bbs.linuxtone.org/forum-14-1.html</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T20:23:16.000Z"><a href="/2010/12/19/top-20-mysql-best-practices/">12月 19 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/19/top-20-mysql-best-practices/">MySQL性能优化的最佳20+条经验</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今 天，数据库的操作越来越成为整个应用的性能瓶颈了，这点对于Web应用尤其明显。关于数据库的性能，这并不只是DBA才需要担心的事，而这更是我们程序员 需要去关注的事情。当我们去设计数据库表结构，对操作数据库时（尤其是查表时的SQL语句），我们都需要注意数据操作的性能。这里，我们不会讲过多的 SQL语句的优化，而只是针对MySQL这一Web应用最多的数据库。希望下面的这些优化技巧对你有用。
<strong>1. 为查询缓存优化你的查询</strong>
大多数的MySQL服务器都开启了查询缓存。这是提高性最有效的方法之一，而且这是被MySQL的数据库引擎处理的。当有很多相同的查询被执行了多次的时候，这些查询结果会被放到一个缓存中，这样，后续的相同的查询就不用操作表而直接访问缓存结果了。
这里最主要的问题是，对于程序员来说，这个事情是很容易被忽略的。因为，我们某些查询语句会让MySQL不使用缓存。请看下面的示例：</p>
<pre><code><figure class="highlight"><pre> // 查询缓存不开启
 $r = mysql_query("<span class="operator"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> signup_date &amp;gt;</span>= CURDATE()");
 // 开启查询缓存
 $today = date("Y-m-d");
 $r = mysql_query("<span class="operator"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> signup_date &amp;gt;</span>= '$today'");`&lt;/pre&gt;
上面两条SQL语句的差别就是 CURDATE() ，MySQL的查询缓存对这个函数不起作用。所以，像 NOW() 和 RAND() 或是其它的诸如此类的SQL函数都不会开启查询缓存，因为这些函数的返回是会不定的易变的。所以，你所需要的就是用一个变量来代替MySQL的函数，从而 开启缓存。

**2\. EXPLAIN 你的 <span class="operator"><span class="keyword">SELECT</span> 查询**
使用 EXPLAIN 关键字可以让你知道MySQL是如何处理你的<span class="keyword">SQL</span>语句的。这可以帮你分析你的查询语句或是表结构的性能瓶颈。
EXPLAIN 的查询结果还会告诉你你的索引主键被如何利用的，你的数据表是如何被搜索和排序的……等等，等等。
挑一个你的<span class="keyword">SELECT</span>语句（推荐挑选那个最复杂的，有多表联接的），把关键字EXPLAIN加到前面。你可以使用phpmyadmin来做这个事。然后，你会看到一张表格。下面的这个示例中，我们忘记加上了group_id索引，并且有表联接：

[![](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/explain.jpg <span class="string">"explain"</span>)](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/explain.jpg)

当我们为 group_id 字段加上索引后：

[![](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/groud.jpg <span class="string">"groud"</span>)](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/groud.jpg)

我们可以看到，前一个结果显示搜索了 <span class="number">7883</span> 行，而后一个只是搜索了两个表的 <span class="number">9</span> 和 <span class="number">16</span> 行。查看<span class="keyword">rows</span>列可以让我们找到潜在的性能问题。
**<span class="number">3</span>\. 当只要一行数据时使用 LIMIT <span class="number">1</span>**
当你查询表的有些时候，你已经知道结果只会有一条结果，但因为你可能需要去<span class="keyword">fetch</span>游标，或是你也许会去检查返回的记录数。
在这种情况下，加上 LIMIT <span class="number">1</span> 可以增加性能。这样一样，MySQL数据库引擎会在找到一条数据后停止搜索，而不是继续往后查少下一条符合记录的数据。
下面的示例，只是为了找一下是否有“中国”的用户，很明显，后面的会比前面的更有效率。（请注意，第一条中是<span class="keyword">Select</span> *，第二条是<span class="keyword">Select</span> <span class="number">1</span>）
&lt;pre&gt;<span class="string">` // 没有效率的：
 $r = mysql_query("SELECT * FROM user WHERE country = 'China'");
 if (mysql_num_rows($r) &amp;gt; 0) {
 // ...
 }

 // 有效率的：
 $r = mysql_query("SELECT 1 FROM user WHERE country = 'China' LIMIT 1");
 if (mysql_num_rows($r) &amp;gt; 0) {
 // ...
 } `</span>&lt;/pre&gt;
**<span class="number">4</span>\. 为搜索字段建索引**
索引并不一定就是给主键或是唯一的字段。如果在你的表中，有某个字段你总要会经常用来做搜索，那么，请为其建立索引吧。

[![](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/<span class="number">4.</span>jpg <span class="string">"4"</span>)](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/<span class="number">4.</span>jpg)

从上图你可以看到那个搜索字串 “last_name <span class="keyword">LIKE</span> ‘a%’”，一个是建了索引，一个是没有索引，性能差了<span class="number">4</span>倍左右。
另外， 你应该也需要知道什么样的搜索是不能使用正常的索引的。例如，当你需要在一篇大的文章中搜索一个词时，如： “<span class="keyword">WHERE</span> post_content <span class="keyword">LIKE</span> ‘%apple%’”，索引可能是没有意义的。你可能需要使用MySQL全文索引 或是自己做一个索引（比如说：搜索关键词或是Tag什么的）
<span class="number">5</span>\. 在<span class="keyword">Join</span>表的时候使用相当类型的例，并将其索引
如果你的应用程序有很多 <span class="keyword">JOIN</span> 查询，你应该确认两个表中<span class="keyword">Join</span>的字段是被建过索引的。这样，MySQL内部会启动为你优化<span class="keyword">Join</span>的<span class="keyword">SQL</span>语句的机制。
而且，这些被用来<span class="keyword">Join</span>的字段，应该是相同的类型的。例如：如果你要把 <span class="keyword">DECIMAL</span> 字段和一个 <span class="keyword">INT</span> 字段<span class="keyword">Join</span>在一起，MySQL就无法使用它们的索引。对于那些STRING类型，还需要有相同的字符集才行。（两个表的字符集有可能不一样）
&lt;pre&gt;<span class="string">` // 在state中查找company
 $r = mysql_query("SELECT company_name FROM users
 LEFT JOIN companies ON (users.state = companies.state)
 WHERE users.id = $user_id");
 // 两个 state 字段应该是被建过索引的，而且应该是相当的类型，相同的字符集。`</span>&lt;/pre&gt;
**<span class="number">6</span>\. 千万不要 <span class="keyword">ORDER</span> <span class="keyword">BY</span> RAND()**
想打乱返回的数据行？随机挑一个数据？真不知道谁发明了这种用法，但很多新手很喜欢这样用。但你确不了解这样做有多么可怕的性能问题。
如果 你真的想把返回的数据行打乱了，你有N种方法可以达到这个目的。这样使用只让你的数据库的性能呈指数级的下降。这里的问题是：MySQL会不得不去执行 RAND()函数（很耗CPU时间），而且这是为了每一行记录去记行，然后再对其排序。就算是你用了Limit <span class="number">1</span>也无济于事（因为要排序）
下面的示例是随机挑一条记录
&lt;pre&gt;<span class="string">` // 千万不要这样做：
 $r = mysql_query("SELECT username FROM user ORDER BY RAND() LIMIT 1");

 // 这要会更好：
 $r = mysql_query("SELECT count(*) FROM user");
 $d = mysql_fetch_row($r);
 $rand = mt_rand(0,$d[0] - 1);

 $r = mysql_query("SELECT username FROM user LIMIT $rand, 1");`</span>&lt;/pre&gt;
**<span class="number">7</span>\. 避免 <span class="keyword">SELECT</span> ***
从数据库里读出越多的数据，那么查询就会变得越慢。并且，如果你的数据库服务器和WEB服务器是两台独立的服务器的话，这还会增加网络传输的负载。
所以，你应该养成一个需要什么就取什么的好的习惯。
&lt;pre&gt;<span class="string">` // 不推荐
 $r = mysql_query("SELECT * FROM user WHERE user_id = 1");
 $d = mysql_fetch_assoc($r);
 echo "Welcome {$d['username']}";

 // 推荐
 $r = mysql_query("SELECT username FROM user WHERE user_id = 1");
 $d = mysql_fetch_assoc($r);
 echo "Welcome {$d['username']}";`</span>&lt;/pre&gt;
**<span class="number">8</span>\. 永远为每张表设置一个ID**
我们应该为数据库里的每张表都设置一个ID做为其主键，而且最好的是一个<span class="keyword">INT</span>型的（推荐使用UNSIGNED），并设置上自动增加的AUTO_INCREMENT标志。
就算是你 users 表有一个主键叫 “email”的字段，你也别让它成为主键。使用 <span class="keyword">VARCHAR</span> 类型来当主键会使用得性能下降。另外，在你的程序中，你应该使用表的ID来构造你的数据结构。
而且，在MySQL数据引擎下，还有一些操作需要使用主键，在这些情况下，主键的性能和设置变得非常重要，比如，集群，分区……
在 这里，只有一个情况是例外，那就是“关联表”的“外键”，也就是说，这个表的主键，通过若干个别的表的主键构成。我们把这个情况叫做“外键”。比如：有一 个“学生表”有学生的ID，有一个“课程表”有课程ID，那么，“成绩表”就是“关联表”了，其关联了学生表和课程表，在成绩表中，学生ID和课程ID叫 “外键”其共同组成主键。

**<span class="number">9</span>\. 使用 ENUM 而不是 <span class="keyword">VARCHAR</span>**
ENUM 类型是非常快和紧凑的。在实际上，其保存的是 TINYINT，但其外表上显示为字符串。这样一来，用这个字段来做一些选项列表变得相当的完美。
如果你有一个字段，比如“性别”，“国家”，“民族”，“状态”或“部门”，你知道这些字段的取值是有限而且固定的，那么，你应该使用 ENUM 而不是 <span class="keyword">VARCHAR</span>。
MySQL也有一个“建议”（见第十条）告诉你怎么去重新组织你的表结构。当你有一个 <span class="keyword">VARCHAR</span> 字段时，这个建议会告诉你把其改成 ENUM 类型。使用 <span class="keyword">PROCEDURE</span> ANALYSE() 你可以得到相关的建议。

**<span class="number">10</span>\. 从 <span class="keyword">PROCEDURE</span> ANALYSE() 取得建议**
<span class="keyword">PROCEDURE</span> ANALYSE() 会让 MySQL 帮你去分析你的字段和其实际的数据，并会给你一些有用的建议。只有表中有实际的数据，这些建议才会变得有用，因为要做一些大的决定是需要有数据作为基础的。
例 如，如果你创建了一个 <span class="keyword">INT</span> 字段作为你的主键，然而并没有太多的数据，那么，<span class="keyword">PROCEDURE</span> ANALYSE()会建议你把这个字段的类型改成 MEDIUMINT 。或是你使用了一个 <span class="keyword">VARCHAR</span> 字段，因为数据不多，你可能会得到一个让你把它改成 ENUM 的建议。这些建议，都是可能因为数据不够多，所以决策做得就不够准。
在phpmyadmin里，你可以在查看表时，点击 “Propose <span class="keyword">table</span> structure” 来查看这些建议

[![](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/<span class="number">10.</span>jpg <span class="string">"10"</span>)](http://bubbyroom.com/wp-content/uploads/<span class="number">2010</span>/<span class="number">12</span>/<span class="number">10.</span>jpg)

一定要注意，这些只是建议，只有当你的表里的数据越来越多时，这些建议才会变得准确。一定要记住，你才是最终做决定的人。

**<span class="number">11</span>\. 尽可能的使用 <span class="keyword">NOT</span> <span class="keyword">NULL</span>**
除非你有一个很特别的原因去使用 <span class="keyword">NULL</span> 值，你应该总是让你的字段保持 <span class="keyword">NOT</span> <span class="keyword">NULL</span>。这看起来好像有点争议，请往下看。
首先，问问你自己“Empty”和“<span class="keyword">NULL</span>”有多大的区别（如果是<span class="keyword">INT</span>，那就是<span class="number">0</span>和<span class="keyword">NULL</span>）？如果你觉得它们之间没有什么区别，那么你就不要使用<span class="keyword">NULL</span>。（你知道吗？在 Oracle 里，<span class="keyword">NULL</span> 和 Empty 的字符串是一样的！)
不要以为 <span class="keyword">NULL</span> 不需要空间，其需要额外的空间，并且，在你进行比较的时候，你的程序会更复杂。 当然，这里并不是说你就不能使用<span class="keyword">NULL</span>了，现实情况是很复杂的，依然会有些情况下，你需要使用<span class="keyword">NULL</span>值。
下面摘自MySQL自己的文档：
“<span class="keyword">NULL</span> columns require additional <span class="keyword">space</span> <span class="keyword">in</span> the row <span class="keyword">to</span> record whether their <span class="keyword">values</span> <span class="keyword">are</span> <span class="keyword">NULL</span>. <span class="keyword">For</span> MyISAM tables, each <span class="keyword">NULL</span> <span class="keyword">column</span> takes one <span class="keyword">bit</span> extra, rounded up <span class="keyword">to</span> the nearest byte.”

**<span class="number">12</span>\. Prepared Statements**
Prepared Statements很像存储过程，是一种运行在后台的<span class="keyword">SQL</span>语句集合，我们可以从使用 prepared statements 获得很多好处，无论是性能问题还是安全问题。
Prepared Statements 可以检查一些你绑定好的变量，这样可以保护你的程序不会受到“<span class="keyword">SQL</span>注入式”攻击。当然，你也可以手动地检查你的这些变量，然而，手动的检查容易出问题， 而且很经常会被程序员忘了。当我们使用一些framework或是ORM的时候，这样的问题会好一些。
在性能方面，当一个相同的查询被使用多次的时候，这会为你带来可观的性能优势。你可以给这些Prepared Statements定义一些参数，而MySQL只会解析一次。
虽然最新版本的MySQL在传输Prepared Statements是使用二进制形势，所以这会使得网络传输非常有效率。
当然，也有一些情况下，我们需要避免使用Prepared Statements，因为其不支持查询缓存。但据说版本<span class="number">5.1</span>后支持了。
在PHP中要使用prepared statements，你可以查看其使用手册：mysqli 扩展 或是使用数据库抽象层，如： PDO.
&lt;pre&gt;<span class="string">` // 创建 prepared statement
 if ($stmt = $mysqli-&amp;gt;prepare("SELECT username FROM user WHERE state=?")) {

 // 绑定参数
 $stmt-&amp;gt;bind_param("s", $state);

 // 执行
 $stmt-&amp;gt;execute();

 // 绑定结果
 $stmt-&amp;gt;bind_result($username);

 // 移动游标
 $stmt-&amp;gt;fetch();

 printf("%s is from %s\n", $username, $state);

 $stmt-&amp;gt;close();
 }`</span>&lt;/pre&gt;
**<span class="number">13</span>\. 无缓冲的查询**
正常的情况下，当你在当你在你的脚本中执行一个<span class="keyword">SQL</span>语句的时候，你的程序会停在那里直到没这个<span class="keyword">SQL</span>语句返回，然后你的程序再往下继续执行。你可以使用无缓冲查询来改变这个行为。
关于这个事情，在PHP的文档中有一个非常不错的说明： mysql_unbuffered_query() 函数：
“mysql_unbuffered_query() sends the <span class="keyword">SQL</span> query query <span class="keyword">to</span> MySQL without automatically fetching <span class="keyword">and</span> buffering the result <span class="keyword">rows</span> <span class="keyword">as</span> mysql_query() does. This saves a considerable amount <span class="keyword">of</span> memory <span class="keyword">with</span> <span class="keyword">SQL</span> queries that produce large result sets, <span class="keyword">and</span> you can <span class="keyword">start</span> working <span class="keyword">on</span> the result <span class="keyword">set</span> immediately after the <span class="keyword">first</span> row has been retrieved <span class="keyword">as</span> you don’t have <span class="keyword">to</span> wait until the complete <span class="keyword">SQL</span> query has been performed.”
上面那句话翻译过来是 说，mysql_unbuffered_query() 发送一个<span class="keyword">SQL</span>语句到MySQL而并不像mysql_query()一样去自动fethch和缓存结果。这会相当节约很多可观的内存，尤其是那些会产生大 量结果的查询语句，并且，你不需要等到所有的结果都返回，只需要第一行数据返回的时候，你就可以开始马上开始工作于查询结果了。
然而，这会 有一些限制。因为你要么把所有行都读走，或是你要在进行下一次的查询前调用 mysql_free_result() 清除结果。而且， mysql_num_rows() 或 mysql_data_seek() 将无法使用。所以，是否使用无缓冲的查询你需要仔细考虑。
** **

**<span class="number">14</span>\. 把IP地址存成 UNSIGNED <span class="keyword">INT</span>**
很多程序员都会创建一个 <span class="keyword">VARCHAR</span>(<span class="number">15</span>) 字段来存放字符串形式的IP而不是整形的IP。如果你用整形来存放，只需要<span class="number">4</span>个字节，并且你可以有定长的字段。而且，这会为你带来查询上的优势，尤其是当 你需要使用这样的<span class="keyword">WHERE</span>条件：IP between ip1 <span class="keyword">and</span> ip2。
我们必需要使用UNSIGNED <span class="keyword">INT</span>，因为 IP地址会使用整个<span class="number">32</span>位的无符号整形。
而你的查询，你可以使用 INET_ATON() 来把一个字符串IP转成一个整形，并使用 INET_NTOA() 把一个整形转成一个字符串IP。在PHP中，也有这样的函数 ip2long() 和 long2ip()。
<span class="number">1</span> $r = <span class="string">"UPDATE users SET ip = INET_ATON('{$_SERVER['REMOTE_ADDR']}') WHERE user_id = $user_id"</span>;</span>

**15\. 固定长度的表会更快**
如果表中的所有字段都是“固定长度”的，整个表会被认为是 “static” 或 “fixed-length”。 例如，表中没有如下类型的字段： VARCHAR，TEXT，BLOB。只要你包括了其中一个这些字段，那么这个表就不是“固定长度静态表”了，这样，MySQL 引擎会用另一种方法来处理。
固定长度的表会提高性能，因为MySQL搜寻得会更快一些，因为这些固定的长度是很容易计算下一个数据的偏移量的，所以读取的自然也会很快。而如果字段不是定长的，那么，每一次要找下一条的话，需要程序找到主键。
并且，固定长度的表也更容易被缓存和重建。不过，唯一的副作用是，固定长度的字段会浪费一些空间，因为定长的字段无论你用不用，他都是要分配那么多的空间。
使用“垂直分割”技术（见下一条），你可以分割你的表成为两个一个是定长的，一个则是不定长的。

**16\. 垂直分割**
“垂直分割”是一种把数据库中的表按列变成几张表的方法，这样可以降低表的复杂度和字段的数目，从而达到优化的目的。（以前，在银行做过项目，见过一张表有100多个字段，很恐怖）
示 例一：在Users表中有一个字段是家庭地址，这个字段是可选字段，相比起，而且你在数据库操作的时候除了个人信息外，你并不需要经常读取或是改写这个字 段。那么，为什么不把他放到另外一张表中呢？ 这样会让你的表有更好的性能，大家想想是不是，大量的时候，我对于用户表来说，只有用户ID，用户名，口令，用户角色等会被经常使用。小一点的表总是会有 好的性能。
示例二： 你有一个叫 “last_login” 的字段，它会在每次用户登录时被更新。但是，每次更新时会导致该表的查询缓存被清空。所以，你可以把这个字段放到另一个表中，这样就不会影响你对用户 ID，用户名，用户角色的不停地读取了，因为查询缓存会帮你增加很多性能。
另外，你需要注意的是，这些被分出去的字段所形成的表，你不会经常性地去Join他们，不然的话，这样的性能会比不分割时还要差，而且，会是极数级的下降。

**17\. 拆分大的 <span class="operator"><span class="keyword">DELETE</span> 或 <span class="keyword">INSERT</span> 语句**
如果你需要在一个在线的网站上去执行一个大的 <span class="keyword">DELETE</span> 或 <span class="keyword">INSERT</span> 查询，你需要非常小心，要避免你的操作让你的整个网站停止相应。因为这两个操作是会锁表的，表一锁住了，别的操作都进不来了。
Apache 会有很多的子进程或线程。所以，其工作起来相当有效率，而我们的服务器也不希望有太多的子进程，线程和数据库链接，这是极大的占服务器资源的事情，尤其是内存。
如果你把你的表锁上一段时间，比如<span class="number">30</span>秒钟，那么对于一个有很高访问量的站点来说，这<span class="number">30</span>秒所积累的访问进程/线程，数据库链接，打开的文件数，可能不仅仅会让你泊WEB服务Crash，还可能会让你的整台服务器马上掛了。
所以，如果你有一个大的处理，你定你一定把其拆分，使用 LIMIT 条件是一个好的方法。下面是一个示例：
&lt;pre&gt;<span class="string">` while (1) {
 //每次只做1000条
 mysql_query("DELETE FROM logs WHERE log_date &amp;lt;= '2009-11-01' LIMIT 1000");
 if (mysql_affected_rows() == 0) {
 // 没得可删了，退出！
 break;
 }
 // 每次都要休息一会儿
 usleep(50000);
 }
</pre></figure></code></pre>
<p><strong>18. 越小的列会越快</strong>
对于大多数的数据库引擎来说，硬盘操作可能是最重大的瓶颈。所以，把你的数据变得紧凑会对这种情况非常有帮助，因为这减少了对硬盘的访问。
参看 MySQL 的文档 Storage Requirements 查看所有的数据类型。
如果一个表只会有几列罢了（比如说字典表，配置表），那么，我们就没有理由使用 INT 来做主键，使用 MEDIUMINT, SMALLINT 或是更小的 TINYINT 会更经济一些。如果你不需要记录时间，使用 DATE 要比 DATETIME 好得多。
当然，你也需要留够足够的扩展空间，不然，你日后来干这个事，你会死的很难看，参看Slashdot的例子（2009年11月06日），一个简单的ALTER TABLE语句花了3个多小时，因为里面有一千六百万条数据。</p>
<p><strong>19. 选择正确的存储引擎</strong>
在 MySQL 中有两个存储引擎 MyISAM 和 InnoDB，每个引擎都有利有弊。酷壳以前文章《MySQL: InnoDB 还是 MyISAM?》讨论和这个事情。
MyISAM 适合于一些需要大量查询的应用，但其对于有大量写操作并不是很好。甚至你只是需要update一个字段，整个表都会被锁起来，而别的进程，就算是读进程都 无法操作直到读操作完成。另外，MyISAM 对于 SELECT COUNT(*) 这类的计算是超快无比的。
InnoDB 的趋势会是一个非常复杂的存储引擎，对于一些小的应用，它会比 MyISAM 还慢。他是它支持“行锁” ，于是在写操作比较多的时候，会更优秀。并且，他还支持更多的高级应用，比如：事务。
下面是MySQL的手册
target=”_blank”MyISAM Storage Engine
InnoDB Storage Engine</p>
<p>20. 使用一个对象关系映射器（Object Relational Mapper）
使用 ORM (Object Relational Mapper)，你能够获得可靠的性能增涨。一个ORM可以做的所有事情，也能被手动的编写出来。但是，这需要一个高级专家。
ORM 的最重要的是“Lazy Loading”，也就是说，只有在需要的去取值的时候才会去真正的去做。但你也需要小心这种机制的副作用，因为这很有可能会因为要去创建很多很多小的查询反而会降低性能。
ORM 还可以把你的SQL语句打包成一个事务，这会比单独执行他们快得多得多。
目前，个人最喜欢的PHP的ORM是：Doctrine。
<strong>21. 小心“永久链接”</strong>
“永久链接”的目的是用来减少重新创建MySQL链接的次数。当一个链接被创建了，它会永远处在连接的状态，就算是数据库操作已经结束了。而且，自从我们 的Apache开始重用它的子进程后——也就是说，下一次的HTTP请求会重用Apache的子进程，并重用相同的 MySQL 链接。</p>
<p>PHP手册：mysql_pconnect()
在理论上来说，这听起来非常的不错。但是从个人经验（也是大多数人的）上来说，这个功能制造出来的麻烦事更多。因为，你只有有限的链接数，内存问题，文件句柄数，等等。
而且，Apache 运行在极端并行的环境中，会创建很多很多的了进程。这就是为什么这种“永久链接”的机制工作地不好的原因。在你决定要使用“永久链接”之前，你需要好好地考虑一下你的整个系统的架构。
（全文完）
转帖自：<a href="http://www.oschina.net/bbs/thread/9917">http://www.oschina.net/bbs/thread/9917</a>
<a href="http://net.tutsplus.com/tutorials/other/top-20-mysql-best-practices/">http://net.tutsplus.com/tutorials/other/top-20-mysql-best-practices/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2010-12-18T06:13:39.000Z"><a href="/2010/12/18/mysql-optimization/">12月 18 2010</a></time>
      
      
  
    <h1 class="title"><a href="/2010/12/18/mysql-optimization/">Mysql编译参数优化</a></h1>
  

    </header>
    <div class="entry">
      
        <p><strong>1. -static 13%</strong></p>
<pre><code><figure class="highlight"><pre><span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">client</span>-<span class="comment">ldflags=</span>-<span class="comment">all</span>-<span class="comment">static</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">mysqld</span>-<span class="comment">ldflags=</span>-<span class="comment">all</span>-<span class="comment">static</span>
<span class="comment">`</span>&lt;<span class="comment">/pre</span>&gt;
<span class="comment">静态链接提高13%性能</span>

<span class="comment">**2\</span>. <span class="literal">-</span><span class="comment">pgcc</span> <span class="comment">1%**</span>

&lt;<span class="comment">pre</span>&gt;<span class="comment">`CFLAGS="</span>-<span class="comment">O3</span> <span class="literal">-</span><span class="comment">mpentiumpro</span> <span class="literal">-</span><span class="comment">mstack</span>-<span class="comment">align</span>-<span class="comment">double"</span> <span class="comment">CXX=gcc</span> <span class="comment">\</span>
<span class="comment">CXXFLAGS="</span>-<span class="comment">O3</span> <span class="literal">-</span><span class="comment">mpentiumpro</span> <span class="literal">-</span><span class="comment">mstack</span>-<span class="comment">align</span>-<span class="comment">double</span> <span class="comment">\</span>
<span class="literal">-</span><span class="comment">felide</span>-<span class="comment">constructors</span> <span class="literal">-</span><span class="comment">fno</span>-<span class="comment">exceptions</span> <span class="literal">-</span><span class="comment">fno</span>-<span class="comment">rtti"</span>
<span class="comment">`</span>&lt;<span class="comment">/pre</span>&gt;

<span class="comment">如果是Inter处理器，使用pgcc提高1%性能</span>
<span class="comment">**</span>
<span class="comment">3\</span>. <span class="comment">Unix</span> <span class="comment">Socket</span> <span class="comment">7</span>.<span class="comment">5%**</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">unix</span>-<span class="comment">socket</span>-<span class="comment">path=/usr/local/mysql/tmp/mysql</span>.<span class="comment">sock</span>
<span class="comment">使用unix套接字链接提高7</span>.<span class="comment">5%性能，所以在windows下mysql性能肯定不如unix下面</span>

<span class="comment">**4\</span>. <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span>-<span class="comment">assembler**</span>
<span class="comment">允许使用汇编模式(优化性能)</span>
<span class="comment">下面是总体的编译文件</span>
<span class="comment">编译代码</span>
&lt;<span class="comment">pre</span>&gt;<span class="comment">`CFLAGS="</span>-<span class="comment">O3"</span> <span class="comment">CXX=gcc</span> <span class="comment">CXXFLAGS="</span>-<span class="comment">O3</span> <span class="literal">-</span><span class="comment">felide</span>-<span class="comment">constructors</span> <span class="comment">\</span>
<span class="literal">-</span><span class="comment">fno</span>-<span class="comment">exceptions</span> <span class="literal">-</span><span class="comment">fno</span>-<span class="comment">rtti</span> <span class="literal">-</span><span class="comment">fomit</span>-<span class="comment">frame</span>-<span class="comment">pointer</span> <span class="literal">-</span><span class="comment">ffixed</span>-<span class="comment">ebp"</span>
<span class="string">.</span><span class="comment">/configure</span> <span class="comment">\</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">prefix=/usr/local/mysql</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span>-<span class="comment">assembler</span> <span class="comment">\</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">mysqld</span>-<span class="comment">ldflags=</span>-<span class="comment">all</span>-<span class="comment">static</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">client</span>-<span class="comment">ldflags=</span>-<span class="comment">all</span>-<span class="comment">static</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">unix</span>-<span class="comment">socket</span>-<span class="comment">path=/usr/local/mysql/tmp/mysql</span>.<span class="comment">sock</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">charset=utf8</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">collation=utf8_general_ci</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">extra</span>-<span class="comment">charsets=all
</pre></figure></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
    <a href="/archives/2010/page/3/" class="alignleft prev">上一页</a>
  
  
    <a href="/archives/2010/page/5/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:bubbyroom.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/cdn/">cdn</a><small>12</small></li>
  
    <li><a href="/categories/faq/">faq</a><small>27</small></li>
  
    <li><a href="/categories/cdn/faq/">faq</a><small>1</small></li>
  
    <li><a href="/categories/faq/howtoforge/">howtoforge</a><small>1</small></li>
  
    <li><a href="/categories/howtoforge/">howtoforge</a><small>6</small></li>
  
    <li><a href="/categories/cdn/puppet/">puppet</a><small>4</small></li>
  
    <li><a href="/categories/puppet/">puppet</a><small>2</small></li>
  
    <li><a href="/categories/cdn/分布式监控/">分布式监控</a><small>2</small></li>
  
    <li><a href="/categories/howtoforge/分布式监控/">分布式监控</a><small>2</small></li>
  
    <li><a href="/categories/分布式监控/">分布式监控</a><small>1</small></li>
  
    <li><a href="/categories/howtoforge/应用程序/">应用程序</a><small>2</small></li>
  
    <li><a href="/categories/应用程序/">应用程序</a><small>19</small></li>
  
    <li><a href="/categories/faq/数据库/">数据库</a><small>1</small></li>
  
    <li><a href="/categories/数据库/">数据库</a><small>4</small></li>
  
    <li><a href="/categories/生活乐事/">生活乐事</a><small>3</small></li>
  
    <li><a href="/categories/程序开发/">程序开发</a><small>4</small></li>
  
    <li><a href="/categories/faq/系统命令/">系统命令</a><small>2</small></li>
  
    <li><a href="/categories/系统命令/">系统命令</a><small>14</small></li>
  
    <li><a href="/categories/美图鉴赏/">美图鉴赏</a><small>1</small></li>
  
    <li><a href="/categories/应用程序/负载均衡/">负载均衡</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/1032/">1032</a><small>1</small></li>
  
    <li><a href="/tags/1236/">1236</a><small>1</small></li>
  
    <li><a href="/tags/403/">403</a><small>1</small></li>
  
    <li><a href="/tags/Cache-control/">Cache-control</a><small>2</small></li>
  
    <li><a href="/tags/Cluster-bacst/">Cluster-bacst</a><small>1</small></li>
  
    <li><a href="/tags/E752x/">E752x</a><small>1</small></li>
  
    <li><a href="/tags/Header-V3-DSA-signature/">Header V3 DSA signature</a><small>1</small></li>
  
    <li><a href="/tags/Python-Imaging-Library/">Python Imaging Library</a><small>1</small></li>
  
    <li><a href="/tags/object-Object/">[object Object]</a><small>1</small></li>
  
    <li><a href="/tags/acl/">acl</a><small>2</small></li>
  
    <li><a href="/tags/allcommands/">allcommands</a><small>1</small></li>
  
    <li><a href="/tags/apache/">apache</a><small>8</small></li>
  
    <li><a href="/tags/arp/">arp</a><small>1</small></li>
  
    <li><a href="/tags/awk/">awk</a><small>4</small></li>
  
    <li><a href="/tags/bash/">bash</a><small>2</small></li>
  
    <li><a href="/tags/best/">best</a><small>1</small></li>
  
    <li><a href="/tags/binding/">binding</a><small>1</small></li>
  
    <li><a href="/tags/binlog/">binlog</a><small>1</small></li>
  
    <li><a href="/tags/bnx2/">bnx2</a><small>1</small></li>
  
    <li><a href="/tags/browser/">browser</a><small>1</small></li>
  
    <li><a href="/tags/cache/">cache</a><small>1</small></li>
  
    <li><a href="/tags/cdn/">cdn</a><small>2</small></li>
  
    <li><a href="/tags/centos/">centos</a><small>8</small></li>
  
    <li><a href="/tags/chmod/">chmod</a><small>1</small></li>
  
    <li><a href="/tags/chown/">chown</a><small>1</small></li>
  
    <li><a href="/tags/commands/">commands</a><small>1</small></li>
  
    <li><a href="/tags/content/">content</a><small>1</small></li>
  
    <li><a href="/tags/cpan/">cpan</a><small>1</small></li>
  
    <li><a href="/tags/cpanm/">cpanm</a><small>1</small></li>
  
    <li><a href="/tags/creating/">creating</a><small>1</small></li>
  
    <li><a href="/tags/dashboard/">dashboard</a><small>1</small></li>
  
    <li><a href="/tags/dell/">dell</a><small>1</small></li>
  
    <li><a href="/tags/diff/">diff</a><small>1</small></li>
  
    <li><a href="/tags/dstat/">dstat</a><small>1</small></li>
  
    <li><a href="/tags/du/">du</a><small>1</small></li>
  
    <li><a href="/tags/eAccelerator/">eAccelerator</a><small>1</small></li>
  
    <li><a href="/tags/end/">end</a><small>1</small></li>
  
    <li><a href="/tags/epel/">epel</a><small>1</small></li>
  
    <li><a href="/tags/etag/">etag</a><small>1</small></li>
  
    <li><a href="/tags/expires/">expires</a><small>1</small></li>
  
    <li><a href="/tags/find/">find</a><small>1</small></li>
  
    <li><a href="/tags/for-1/">for</a><small>1</small></li>
  
    <li><a href="/tags/foreman/">foreman</a><small>1</small></li>
  
    <li><a href="/tags/ftp/">ftp</a><small>1</small></li>
  
    <li><a href="/tags/ganglia/">ganglia</a><small>2</small></li>
  
    <li><a href="/tags/gmond/">gmond</a><small>1</small></li>
  
    <li><a href="/tags/group/">group</a><small>1</small></li>
  
    <li><a href="/tags/groupadd/">groupadd</a><small>1</small></li>
  
    <li><a href="/tags/gzip/">gzip</a><small>1</small></li>
  
    <li><a href="/tags/howto/">howto</a><small>2</small></li>
  
    <li><a href="/tags/http_realip_module/">http_realip_module</a><small>1</small></li>
  
    <li><a href="/tags/ideauthority/">ideauthority</a><small>1</small></li>
  
    <li><a href="/tags/if/">if</a><small>2</small></li>
  
    <li><a href="/tags/ifconfig/">ifconfig</a><small>1</small></li>
  
    <li><a href="/tags/ignore/">ignore</a><small>1</small></li>
  
    <li><a href="/tags/init/">init</a><small>1</small></li>
  
    <li><a href="/tags/iostat/">iostat</a><small>2</small></li>
  
    <li><a href="/tags/ip-1/">ip</a><small>1</small></li>
  
    <li><a href="/tags/iptables/">iptables</a><small>1</small></li>
  
    <li><a href="/tags/jk/">jk</a><small>1</small></li>
  
    <li><a href="/tags/kcore/">kcore</a><small>1</small></li>
  
    <li><a href="/tags/kernel/">kernel</a><small>1</small></li>
  
    <li><a href="/tags/kick/">kick</a><small>1</small></li>
  
    <li><a href="/tags/libmemcached/">libmemcached</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>18</small></li>
  
    <li><a href="/tags/lsof/">lsof</a><small>1</small></li>
  
    <li><a href="/tags/lvs/">lvs</a><small>1</small></li>
  
    <li><a href="/tags/master/">master</a><small>2</small></li>
  
    <li><a href="/tags/metric/">metric</a><small>1</small></li>
  
    <li><a href="/tags/mod_cband/">mod_cband</a><small>1</small></li>
  
    <li><a href="/tags/mod_limitipconn/">mod_limitipconn</a><small>1</small></li>
  
    <li><a href="/tags/moinmoin/">moinmoin</a><small>1</small></li>
  
    <li><a href="/tags/monitoring/">monitoring</a><small>1</small></li>
  
    <li><a href="/tags/moudles/">moudles</a><small>1</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>6</small></li>
  
    <li><a href="/tags/nagios/">nagios</a><small>1</small></li>
  
    <li><a href="/tags/netstat/">netstat</a><small>2</small></li>
  
    <li><a href="/tags/nginx/">nginx</a><small>4</small></li>
  
    <li><a href="/tags/optimization/">optimization</a><small>1</small></li>
  
    <li><a href="/tags/packet/">packet</a><small>1</small></li>
  
    <li><a href="/tags/pam/">pam</a><small>1</small></li>
  
    <li><a href="/tags/per-fcgi/">per-fcgi</a><small>1</small></li>
  
    <li><a href="/tags/perl/">perl</a><small>1</small></li>
  
    <li><a href="/tags/permission/">permission</a><small>1</small></li>
  
    <li><a href="/tags/php-1/">php</a><small>2</small></li>
  
    <li><a href="/tags/php-fpm/">php-fpm</a><small>2</small></li>
  
    <li><a href="/tags/pil/">pil</a><small>1</small></li>
  
    <li><a href="/tags/port/">port</a><small>1</small></li>
  
    <li><a href="/tags/practices/">practices</a><small>1</small></li>
  
    <li><a href="/tags/proftpd/">proftpd</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>2</small></li>
  
    <li><a href="/tags/ps/">ps</a><small>2</small></li>
  
    <li><a href="/tags/puppet/">puppet</a><small>6</small></li>
  
    <li><a href="/tags/puppetrun/">puppetrun</a><small>1</small></li>
  
    <li><a href="/tags/python-1/">python</a><small>3</small></li>
  
    <li><a href="/tags/python26/">python2.6</a><small>1</small></li>
  
    <li><a href="/tags/quick/">quick</a><small>1</small></li>
  
    <li><a href="/tags/r410/">r410</a><small>1</small></li>
  
    <li><a href="/tags/r710/">r710</a><small>1</small></li>
  
    <li><a href="/tags/raw/">raw</a><small>1</small></li>
  
    <li><a href="/tags/referer/">referer</a><small>1</small></li>
  
    <li><a href="/tags/replicate/">replicate</a><small>1</small></li>
  
    <li><a href="/tags/repo/">repo</a><small>1</small></li>
  
    <li><a href="/tags/resources/">resources</a><small>1</small></li>
  
    <li><a href="/tags/rhel/">rhel</a><small>1</small></li>
  
    <li><a href="/tags/rpmbuild/">rpmbuild</a><small>1</small></li>
  
    <li><a href="/tags/rpmcreate/">rpmcreate</a><small>1</small></li>
  
    <li><a href="/tags/ruby/">ruby</a><small>1</small></li>
  
    <li><a href="/tags/sar/">sar</a><small>1</small></li>
  
    <li><a href="/tags/scribe/">scribe</a><small>2</small></li>
  
    <li><a href="/tags/sed/">sed</a><small>4</small></li>
  
    <li><a href="/tags/sedline/">sedline</a><small>1</small></li>
  
    <li><a href="/tags/sending/">sending</a><small>1</small></li>
  
    <li><a href="/tags/sendmail/">sendmail</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>2</small></li>
  
    <li><a href="/tags/shtml/">shtml</a><small>1</small></li>
  
    <li><a href="/tags/slave/">slave</a><small>2</small></li>
  
    <li><a href="/tags/smartctl/">smartctl</a><small>1</small></li>
  
    <li><a href="/tags/smokeping/">smokeping</a><small>1</small></li>
  
    <li><a href="/tags/spec/">spec</a><small>2</small></li>
  
    <li><a href="/tags/squid/">squid</a><small>1</small></li>
  
    <li><a href="/tags/ssi/">ssi</a><small>1</small></li>
  
    <li><a href="/tags/system/">system</a><small>1</small></li>
  
    <li><a href="/tags/tar/">tar</a><small>1</small></li>
  
    <li><a href="/tags/tcpdump/">tcpdump</a><small>2</small></li>
  
    <li><a href="/tags/tomcat/">tomcat</a><small>4</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>1</small></li>
  
    <li><a href="/tags/top/">top</a><small>1</small></li>
  
    <li><a href="/tags/tree/">tree</a><small>1</small></li>
  
    <li><a href="/tags/ubuntu/">ubuntu</a><small>4</small></li>
  
    <li><a href="/tags/upgrade/">upgrade</a><small>1</small></li>
  
    <li><a href="/tags/user/">user</a><small>2</small></li>
  
    <li><a href="/tags/useradd/">useradd</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>2</small></li>
  
    <li><a href="/tags/vmstat/">vmstat</a><small>2</small></li>
  
    <li><a href="/tags/vsftpd/">vsftpd</a><small>1</small></li>
  
    <li><a href="/tags/while/">while</a><small>1</small></li>
  
    <li><a href="/tags/wiki/">wiki</a><small>1</small></li>
  
    <li><a href="/tags/windows7/">windows7</a><small>1</small></li>
  
    <li><a href="/tags/winsxs/">winsxs</a><small>1</small></li>
  
    <li><a href="/tags/wordpress/">wordpress</a><small>1</small></li>
  
    <li><a href="/tags/yum/">yum</a><small>10</small></li>
  
    <li><a href="/tags/zabbix/">zabbix</a><small>1</small></li>
  
    <li><a href="/tags/一句话命令/">一句话命令</a><small>1</small></li>
  
    <li><a href="/tags/主从配置/">主从配置</a><small>1</small></li>
  
    <li><a href="/tags/优化/">优化</a><small>1</small></li>
  
    <li><a href="/tags/内核/">内核</a><small>1</small></li>
  
    <li><a href="/tags/分布式/">分布式</a><small>1</small></li>
  
    <li><a href="/tags/分布式监控/">分布式监控</a><small>1</small></li>
  
    <li><a href="/tags/单引号/">单引号</a><small>1</small></li>
  
    <li><a href="/tags/参考/">参考</a><small>1</small></li>
  
    <li><a href="/tags/双引号/">双引号</a><small>1</small></li>
  
    <li><a href="/tags/命令详解/">命令详解</a><small>7</small></li>
  
    <li><a href="/tags/对比/">对比</a><small>1</small></li>
  
    <li><a href="/tags/性能优化/">性能优化</a><small>1</small></li>
  
    <li><a href="/tags/日志/">日志</a><small>2</small></li>
  
    <li><a href="/tags/环境变量/">环境变量</a><small>1</small></li>
  
    <li><a href="/tags/硬件中断/">硬件中断</a><small>1</small></li>
  
    <li><a href="/tags/管理/">管理</a><small>1</small></li>
  
    <li><a href="/tags/系统命令/">系统命令</a><small>1</small></li>
  
    <li><a href="/tags/系统管理技巧/">系统管理技巧</a><small>1</small></li>
  
    <li><a href="/tags/网卡丢包/">网卡丢包</a><small>1</small></li>
  
    <li><a href="/tags/网卡驱动/">网卡驱动</a><small>1</small></li>
  
    <li><a href="/tags/老板/">老板</a><small>1</small></li>
  
    <li><a href="/tags/认证/">认证</a><small>1</small></li>
  
    <li><a href="/tags/详解/">详解</a><small>3</small></li>
  
    <li><a href="/tags/过滤日志/">过滤日志</a><small>1</small></li>
  
    <li><a href="/tags/集中化管理/">集中化管理</a><small>1</small></li>
  
    <li><a href="/tags/面试题/">面试题</a><small>1</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 Liu Yu
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>